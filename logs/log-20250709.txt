2025-07-09 09:02:53.499 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 09:02:53.544 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-09 09:02:53.556 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-09 09:02:53.598 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-09 09:02:53.603 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 09:02:53.604 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-09 09:02:53.606 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-09 09:02:53.612 +07:00 [INF] Applying migration '20250709020226_AddRequestLogsTable'.
2025-07-09 09:02:53.623 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [RequestLogs] (
    [Id] int NOT NULL IDENTITY,
    [RequestId] nvarchar(50) NOT NULL,
    [Status] nvarchar(20) NOT NULL,
    [CreatedAt] datetime2 NOT NULL,
    [LastUpdatedAt] datetime2 NULL,
    [ErrorMessage] nvarchar(1000) NULL,
    [RequestData] nvarchar(max) NULL,
    CONSTRAINT [PK_RequestLogs] PRIMARY KEY ([Id])
);
2025-07-09 09:02:53.626 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250709020226_AddRequestLogsTable', N'9.0.6');
2025-07-09 09:02:53.628 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-09 09:17:59.654 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 09:17:59.698 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-09 09:17:59.712 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-09 09:17:59.755 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-09 09:17:59.761 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 09:17:59.764 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-09 09:17:59.768 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-09 09:17:59.774 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-09 09:17:59.776 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-09 09:18:00.050 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-09 09:18:00.164 +07:00 [INF] Hangfire SQL objects installed.
2025-07-09 09:18:00.573 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-09 09:18:00.574 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-09 09:18:00.659 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-09 09:18:00.660 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-09 09:18:00.661 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-09 09:18:00.673 +07:00 [DBG] Execution loop BackgroundServerProcess:b1c4318a has started in 5.9305 ms
2025-07-09 09:18:00.680 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-09 09:18:00.681 +07:00 [INF] Hosting environment: Development
2025-07-09 09:18:00.682 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-09 09:18:00.701 +07:00 [INF] Server digi-tbhh2:12544:3ea90ec2 successfully announced in 20.6676 ms
2025-07-09 09:18:00.706 +07:00 [DBG] Execution loop ServerHeartbeatProcess:b9b1921b has started in 4.283 ms
2025-07-09 09:18:00.706 +07:00 [INF] Server digi-tbhh2:12544:3ea90ec2 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-09 09:18:00.711 +07:00 [DBG] Execution loop ServerWatchdog:8e1e0bcb has started in 3.497 ms
2025-07-09 09:18:00.716 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:166b4a37 has started in 5.2035 ms
2025-07-09 09:18:00.714 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:865eea13 has started in 5.7872 ms
2025-07-09 09:18:00.720 +07:00 [DBG] Execution loop ExpirationManager:647729db has started in 6.4497 ms
2025-07-09 09:18:00.722 +07:00 [DBG] Execution loop CountersAggregator:4da466d3 has started in 6.05 ms
2025-07-09 09:18:00.726 +07:00 [DBG] Execution loop Worker:5db4ec2f has started in 6.6916 ms
2025-07-09 09:18:00.737 +07:00 [INF] 1 servers were removed due to timeout
2025-07-09 09:18:00.743 +07:00 [DBG] Execution loop Worker:160c6a39 has started in 24.1736 ms
2025-07-09 09:18:00.741 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-09 09:18:00.739 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 09:18:00.728 +07:00 [DBG] Execution loop Worker:6e2e1df3 has started in 9.4223 ms
2025-07-09 09:18:00.731 +07:00 [DBG] Execution loop Worker:17c87563 has started in 12.2596 ms
2025-07-09 09:18:00.734 +07:00 [DBG] Execution loop Worker:642c56ea has started in 15.0178 ms
2025-07-09 09:18:00.738 +07:00 [DBG] Execution loop Worker:682b3a74 has started in 18.6399 ms
2025-07-09 09:18:00.740 +07:00 [DBG] Execution loop Worker:5ac829fa has started in 21.4807 ms
2025-07-09 09:18:00.746 +07:00 [DBG] Execution loop Worker:5ba6b504 has started in 27.0355 ms
2025-07-09 09:18:00.749 +07:00 [DBG] Execution loop Worker:53393829 has started in 29.9477 ms
2025-07-09 09:18:00.753 +07:00 [DBG] Execution loop Worker:6078125a has started in 34.0921 ms
2025-07-09 09:18:00.755 +07:00 [DBG] Execution loop Worker:0325fdba has started in 36.0259 ms
2025-07-09 09:18:00.816 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-09 09:18:00.819 +07:00 [INF] Server digi-tbhh2:12544:3ea90ec2 all the dispatchers started
2025-07-09 09:18:00.758 +07:00 [DBG] Execution loop Worker:65c81199 has started in 38.9882 ms
2025-07-09 09:18:00.761 +07:00 [DBG] Execution loop Worker:30c55449 has started in 42.0183 ms
2025-07-09 09:18:00.764 +07:00 [DBG] Execution loop Worker:18e77b86 has started in 45.0302 ms
2025-07-09 09:18:00.799 +07:00 [DBG] Execution loop Worker:3ea03b13 has started in 79.5743 ms
2025-07-09 09:18:00.799 +07:00 [DBG] Execution loop Worker:82770161 has started in 79.5758 ms
2025-07-09 09:18:00.805 +07:00 [DBG] Execution loop Worker:7823bbe2 has started in 84.6706 ms
2025-07-09 09:18:00.809 +07:00 [DBG] Execution loop Worker:936ec766 has started in 90.0879 ms
2025-07-09 09:18:00.811 +07:00 [DBG] Execution loop Worker:a717120b has started in 92.459 ms
2025-07-09 09:18:00.815 +07:00 [DBG] Execution loop Worker:2da2f089 has started in 96.2832 ms
2025-07-09 09:18:00.820 +07:00 [DBG] Execution loop DelayedJobScheduler:ba2c322f has started in 8.7118 ms
2025-07-09 09:18:00.822 +07:00 [DBG] Execution loop RecurringJobScheduler:da26cb59 has started in 7.1808 ms
2025-07-09 09:18:00.841 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-09 09:18:00.851 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-09 09:18:00.855 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-09 09:18:00.962 +07:00 [DBG] 1 recurring job(s) processed by scheduler.
2025-07-09 09:18:01.036 +07:00 [INF] Performing daily data cleanup at 7/9/2025 9:18:01 AM
2025-07-09 09:18:01.454 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-09 09:18:01.454 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-09 09:18:01.484 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 34.5276ms
2025-07-09 09:18:01.604 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 156.9021ms
2025-07-09 09:18:01.632 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-09 09:18:01.668 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 35.8409ms
2025-07-09 09:18:02.053 +07:00 [INF] Daily data cleanup completed.
2025-07-09 09:18:30.731 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:19:00.744 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:19:30.757 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:20:00.765 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:20:08.721 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 570
2025-07-09 09:20:08.752 +07:00 [INF] CORS policy execution failed.
2025-07-09 09:20:08.754 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 09:20:08.757 +07:00 [INF] Request from IP: ::1
2025-07-09 09:20:08.763 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 09:20:08.787 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 09:20:08.985 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-09 09:20:09.148 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 1000), @p2='?' (DbType = DateTime2), @p3='?' (Size = 4000), @p4='?' (Size = 50), @p5='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [RequestLogs] ([CreatedAt], [ErrorMessage], [LastUpdatedAt], [RequestData], [RequestId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-09 09:20:09.199 +07:00 [INF] Enqueued job for RequestId: cc64c0fb-6b5d-49b9-bdb8-4f785607e776
2025-07-09 09:20:09.208 +07:00 [INF] Executing AcceptedResult, writing value of type 'pviBase.Dtos.ApiResponse`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-09 09:20:09.222 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 430.7146ms
2025-07-09 09:20:09.224 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 09:20:09.246 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 202 99 application/json 524.6042ms
2025-07-09 09:20:09.485 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 09:20:09.498 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0, [Status] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-09 09:20:09.501 +07:00 [INF] Processing job for RequestId: cc64c0fb-6b5d-49b9-bdb8-4f785607e776
2025-07-09 09:20:09.745 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-09 09:20:09.760 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 09:20:09.764 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0, [Status] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-09 09:20:09.765 +07:00 [INF] Job for RequestId: cc64c0fb-6b5d-49b9-bdb8-4f785607e776 completed successfully.
2025-07-09 09:20:30.773 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:21:00.789 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:21:30.798 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:22:00.815 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:22:30.822 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:23:00.825 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 09:23:00.827 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:23:30.840 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:24:00.856 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:24:30.869 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:25:00.885 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:25:30.899 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:26:00.915 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:26:30.930 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:27:00.949 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:27:30.962 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:28:00.839 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 09:28:00.985 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:28:30.992 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:29:01.010 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:29:31.024 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:30:01.041 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:30:31.045 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:31:01.057 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:31:31.066 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:32:01.081 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:32:31.094 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:33:00.863 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 09:33:01.102 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:33:31.112 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:34:01.124 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:34:31.133 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:35:01.136 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:35:31.150 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:36:01.163 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:36:31.169 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:37:01.183 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:37:31.191 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:38:00.881 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 09:38:01.211 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:38:31.222 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:39:01.239 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:39:31.250 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:40:01.257 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:40:31.274 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:41:01.287 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:41:31.291 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:42:01.306 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:42:31.318 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:43:00.903 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 09:43:01.329 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:43:31.332 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:44:01.364 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:44:31.379 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:45:01.387 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:45:31.520 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:46:01.547 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:46:31.561 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:47:01.572 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:47:31.586 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:48:00.869 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-09 09:48:00.878 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-09 09:48:00.892 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-09 09:48:00.894 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-09 09:48:00.896 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-09 09:48:00.912 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 09:48:01.594 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:48:31.599 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:49:01.605 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:49:31.617 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:50:01.633 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:50:31.638 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:51:01.640 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:51:31.650 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:52:01.658 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:52:31.676 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:53:00.936 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 09:53:01.687 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:53:31.694 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:54:01.702 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:54:31.723 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:55:01.739 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:55:31.758 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:56:01.763 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:56:31.773 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:57:01.789 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:57:31.794 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:58:00.961 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 09:58:01.801 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:58:31.816 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:59:01.824 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 09:59:31.832 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:00:01.851 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:00:31.869 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:01:01.882 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:01:31.892 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:02:01.909 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:02:31.924 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:03:00.979 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 10:03:01.931 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:03:31.943 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:04:01.954 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:04:31.971 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:05:01.986 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:05:32.004 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:06:02.023 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:06:32.036 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:07:02.047 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:07:32.054 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:08:00.992 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 10:08:02.065 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:08:32.081 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:09:02.099 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:09:32.105 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:10:02.118 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:10:32.130 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:11:02.150 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:11:32.163 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:12:02.172 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:12:32.190 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:13:01.007 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 10:13:02.204 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:13:32.223 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:14:02.240 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:14:32.254 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:15:02.262 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:15:32.274 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 10:15:53.025 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - application/json-patch+json 115
2025-07-09 10:15:53.035 +07:00 [INF] CORS policy execution failed.
2025-07-09 10:15:53.036 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 10:15:53.037 +07:00 [INF] Request from IP: ::1
2025-07-09 10:15:53.038 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-09 10:15:53.049 +07:00 [INF] Route matched with {action = "GetContractByLoanNo", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContractByLoanNo(pviBase.Dtos.GetContractByLoanNoRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 10:15:53.072 +07:00 [INF] Received request to get detailed contract for LoanNo: LN22000001
2025-07-09 10:15:53.116 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__loanNo_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [i].[Id], [i].[CreatedAt], [i].[CustAddress], [i].[CustBirthday], [i].[CustEmail], [i].[CustGender], [i].[CustIdNo], [i].[CustName], [i].[CustPhone], [i].[DisbursementDate], [i].[InsRate], [i].[LoanAmount], [i].[LoanDate], [i].[LoanNo], [i].[LoanTerm], [i].[LoanType], [i].[UpdatedAt]
FROM [InsuranceContracts] AS [i]
WHERE [i].[LoanNo] = @__loanNo_0
2025-07-09 10:15:53.126 +07:00 [INF] Successfully retrieved detailed contract for LoanNo: LN22000001
2025-07-09 10:15:53.127 +07:00 [INF] Executing OkObjectResult, writing value of type 'pviBase.Dtos.GetContractByLoanNoResponseDataDto'.
2025-07-09 10:15:53.137 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase) in 86.6799ms
2025-07-09 10:15:53.138 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-09 10:15:53.149 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - 200 1031 application/json 124.2691ms
2025-07-09 10:16:02.282 +07:00 [DBG] Server digi-tbhh2:12544:3ea90ec2 heartbeat successfully sent
2025-07-09 14:54:09.807 +07:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 14:54:09.853 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-09 14:54:09.900 +07:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-09 14:54:09.962 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-09 14:54:09.969 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 14:54:09.972 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-09 14:54:09.988 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-09 14:54:09.994 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-09 14:54:09.997 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-09 14:54:10.254 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-09 14:54:10.419 +07:00 [INF] Hangfire SQL objects installed.
2025-07-09 14:54:10.827 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-09 14:54:10.828 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-09 14:54:10.905 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-09 14:54:10.906 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-09 14:54:10.906 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-09 14:54:10.918 +07:00 [DBG] Execution loop BackgroundServerProcess:5507325c has started in 5.9701 ms
2025-07-09 14:54:10.926 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-09 14:54:10.928 +07:00 [INF] Hosting environment: Development
2025-07-09 14:54:10.929 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-09 14:54:10.943 +07:00 [INF] Server digi-tbhh2:22192:88c64a15 successfully announced in 16.3806 ms
2025-07-09 14:54:10.947 +07:00 [INF] Server digi-tbhh2:22192:88c64a15 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-09 14:54:10.948 +07:00 [DBG] Execution loop ServerHeartbeatProcess:3014f6d7 has started in 4.5125 ms
2025-07-09 14:54:10.952 +07:00 [DBG] Execution loop ServerWatchdog:7fd46532 has started in 2.805 ms
2025-07-09 14:54:10.956 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:fab2355e has started in 6.6246 ms
2025-07-09 14:54:10.962 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:52f4121b has started in 9.4562 ms
2025-07-09 14:54:10.964 +07:00 [DBG] Execution loop ExpirationManager:ecbfa135 has started in 8.1497 ms
2025-07-09 14:54:10.969 +07:00 [DBG] Execution loop CountersAggregator:28edabec has started in 7.3405 ms
2025-07-09 14:54:10.973 +07:00 [DBG] Execution loop Worker:e8db6639 has started in 8.2683 ms
2025-07-09 14:54:10.977 +07:00 [DBG] Execution loop Worker:7cc976f0 has started in 12.068 ms
2025-07-09 14:54:10.982 +07:00 [INF] 1 servers were removed due to timeout
2025-07-09 14:54:10.984 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-09 14:54:10.982 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 14:54:10.981 +07:00 [DBG] Execution loop Worker:dc93aaf2 has started in 15.8258 ms
2025-07-09 14:54:10.984 +07:00 [DBG] Execution loop Worker:795681ba has started in 19.534 ms
2025-07-09 14:54:10.990 +07:00 [DBG] Execution loop Worker:879def74 has started in 25.092 ms
2025-07-09 14:54:10.991 +07:00 [DBG] Execution loop Worker:8e285f75 has started in 26.9316 ms
2025-07-09 14:54:10.995 +07:00 [DBG] Execution loop Worker:daf1bad1 has started in 30.1057 ms
2025-07-09 14:54:10.998 +07:00 [DBG] Execution loop Worker:4ef13d8c has started in 32.9755 ms
2025-07-09 14:54:11.001 +07:00 [DBG] Execution loop Worker:e79e88bc has started in 36.073 ms
2025-07-09 14:54:11.004 +07:00 [DBG] Execution loop Worker:a66af85a has started in 39.2312 ms
2025-07-09 14:54:11.007 +07:00 [DBG] Execution loop Worker:369dc05f has started in 42.3303 ms
2025-07-09 14:54:11.010 +07:00 [DBG] Execution loop Worker:67d57dec has started in 45.3972 ms
2025-07-09 14:54:11.014 +07:00 [DBG] Execution loop Worker:d0854576 has started in 49.0877 ms
2025-07-09 14:54:11.017 +07:00 [DBG] Execution loop Worker:2fe4f07e has started in 52.8392 ms
2025-07-09 14:54:11.042 +07:00 [INF] Server digi-tbhh2:22192:88c64a15 all the dispatchers started
2025-07-09 14:54:11.039 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-09 14:54:11.021 +07:00 [DBG] Execution loop Worker:8f8d92a9 has started in 56.3611 ms
2025-07-09 14:54:11.024 +07:00 [DBG] Execution loop Worker:a9ede4a2 has started in 59.796 ms
2025-07-09 14:54:11.028 +07:00 [DBG] Execution loop Worker:77520ecc has started in 63.682 ms
2025-07-09 14:54:11.032 +07:00 [DBG] Execution loop Worker:ce7c5460 has started in 67.4385 ms
2025-07-09 14:54:11.035 +07:00 [DBG] Execution loop Worker:9eb9ecdf has started in 70.5623 ms
2025-07-09 14:54:11.038 +07:00 [DBG] Execution loop Worker:4bf84d46 has started in 73.728 ms
2025-07-09 14:54:11.042 +07:00 [DBG] Execution loop DelayedJobScheduler:49d51dce has started in 6.6212 ms
2025-07-09 14:54:11.045 +07:00 [DBG] Execution loop RecurringJobScheduler:c1bc88af has started in 6.8685 ms
2025-07-09 14:54:11.075 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-09 14:54:11.081 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-09 14:54:11.083 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-09 14:54:11.708 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-09 14:54:11.708 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-09 14:54:11.744 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 41.8546ms
2025-07-09 14:54:11.837 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 136.6759ms
2025-07-09 14:54:11.868 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-09 14:54:11.901 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 34.0667ms
2025-07-09 14:54:40.987 +07:00 [DBG] Server digi-tbhh2:22192:88c64a15 heartbeat successfully sent
2025-07-09 14:55:05.624 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 577
2025-07-09 14:55:05.653 +07:00 [INF] CORS policy execution failed.
2025-07-09 14:55:05.654 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 14:55:05.657 +07:00 [INF] Request from IP: ::1
2025-07-09 14:55:05.662 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 14:55:05.687 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 14:55:05.876 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-09 14:55:06.055 +07:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 1000), @p2='?' (DbType = DateTime2), @p3='?' (Size = 4000), @p4='?' (Size = 50), @p5='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [RequestLogs] ([CreatedAt], [ErrorMessage], [LastUpdatedAt], [RequestData], [RequestId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-09 14:55:06.155 +07:00 [INF] Enqueued job for RequestId: fe719c62-574b-4564-99e2-b991f21cbb14
2025-07-09 14:55:06.164 +07:00 [INF] Executing AcceptedResult, writing value of type 'pviBase.Dtos.ApiResponse`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-09 14:55:06.186 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 494.381ms
2025-07-09 14:55:06.187 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 14:55:06.199 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 202 99 application/json 575.7109ms
2025-07-09 14:55:06.492 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 14:55:06.510 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0, [Status] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-09 14:55:06.515 +07:00 [INF] Processing job for RequestId: fe719c62-574b-4564-99e2-b991f21cbb14
2025-07-09 14:55:06.779 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-09 14:55:06.793 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 14:55:06.798 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0, [Status] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-09 14:55:06.800 +07:00 [INF] Job for RequestId: fe719c62-574b-4564-99e2-b991f21cbb14 completed successfully.
2025-07-09 14:55:11.000 +07:00 [DBG] Server digi-tbhh2:22192:88c64a15 heartbeat successfully sent
2025-07-09 14:55:41.017 +07:00 [DBG] Server digi-tbhh2:22192:88c64a15 heartbeat successfully sent
2025-07-09 14:56:11.038 +07:00 [DBG] Server digi-tbhh2:22192:88c64a15 heartbeat successfully sent
2025-07-09 14:56:29.819 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - application/json-patch+json 115
2025-07-09 14:56:29.829 +07:00 [INF] CORS policy execution failed.
2025-07-09 14:56:29.830 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 14:56:29.831 +07:00 [INF] Request from IP: ::1
2025-07-09 14:56:29.832 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-09 14:56:29.836 +07:00 [INF] Route matched with {action = "GetContractByLoanNo", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContractByLoanNo(pviBase.Dtos.GetContractByLoanNoRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 14:56:29.842 +07:00 [INF] Received request to get detailed contract for LoanNo: LN22000001
2025-07-09 14:56:29.854 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__loanNo_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [i].[Id], [i].[CreatedAt], [i].[CustAddress], [i].[CustBirthday], [i].[CustEmail], [i].[CustGender], [i].[CustIdNo], [i].[CustName], [i].[CustPhone], [i].[DisbursementDate], [i].[InsRate], [i].[LoanAmount], [i].[LoanDate], [i].[LoanNo], [i].[LoanTerm], [i].[LoanType], [i].[UpdatedAt]
FROM [InsuranceContracts] AS [i]
WHERE [i].[LoanNo] = @__loanNo_0
2025-07-09 14:56:29.861 +07:00 [INF] Successfully retrieved detailed contract for LoanNo: LN22000001
2025-07-09 14:56:29.863 +07:00 [INF] Executing OkObjectResult, writing value of type 'pviBase.Dtos.GetContractByLoanNoResponseDataDto'.
2025-07-09 14:56:29.869 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase) in 31.9415ms
2025-07-09 14:56:29.870 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-09 14:56:29.875 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - 200 1031 application/json 56.9308ms
2025-07-09 14:56:41.055 +07:00 [DBG] Server digi-tbhh2:22192:88c64a15 heartbeat successfully sent
2025-07-09 14:57:11.065 +07:00 [DBG] Server digi-tbhh2:22192:88c64a15 heartbeat successfully sent
2025-07-09 14:57:41.072 +07:00 [DBG] Server digi-tbhh2:22192:88c64a15 heartbeat successfully sent
2025-07-09 14:58:11.087 +07:00 [DBG] Server digi-tbhh2:22192:88c64a15 heartbeat successfully sent
2025-07-09 14:58:41.093 +07:00 [DBG] Server digi-tbhh2:22192:88c64a15 heartbeat successfully sent
2025-07-09 14:59:11.086 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 14:59:11.104 +07:00 [DBG] Server digi-tbhh2:22192:88c64a15 heartbeat successfully sent
2025-07-09 14:59:41.118 +07:00 [DBG] Server digi-tbhh2:22192:88c64a15 heartbeat successfully sent
2025-07-09 15:01:41.158 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 15:01:41.187 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-09 15:01:41.197 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-09 15:01:41.233 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-09 15:01:41.236 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 15:01:41.237 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-09 15:01:41.239 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-09 15:01:41.244 +07:00 [INF] Applying migration '20250709080130_AddUniqueConstraintToLoanNo'.
2025-07-09 15:01:41.289 +07:00 [ERR] Failed executing DbCommand (40ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX [IX_InsuranceContracts_LoanNo] ON [InsuranceContracts] ([LoanNo]);
2025-07-09 15:03:18.105 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 15:03:18.132 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-09 15:03:18.141 +07:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-09 15:03:18.177 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-09 15:03:18.182 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 15:03:18.182 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-09 15:03:18.184 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-09 15:03:18.190 +07:00 [INF] Applying migration '20250709080130_AddUniqueConstraintToLoanNo'.
2025-07-09 15:03:18.198 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX [IX_InsuranceContracts_LoanNo] ON [InsuranceContracts] ([LoanNo]);
2025-07-09 15:03:18.200 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250709080130_AddUniqueConstraintToLoanNo', N'9.0.6');
2025-07-09 15:03:18.203 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-09 15:03:28.473 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 15:03:28.509 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-09 15:03:28.520 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-09 15:03:28.563 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-09 15:03:28.570 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 15:03:28.572 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-09 15:03:28.575 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-09 15:03:28.583 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-09 15:03:28.585 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-09 15:03:28.707 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-09 15:03:28.805 +07:00 [INF] Hangfire SQL objects installed.
2025-07-09 15:03:29.046 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-09 15:03:29.047 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-09 15:03:29.118 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-09 15:03:29.119 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-09 15:03:29.120 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-09 15:03:29.130 +07:00 [DBG] Execution loop BackgroundServerProcess:7075ddc5 has started in 5.5065 ms
2025-07-09 15:03:29.159 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-09 15:03:29.161 +07:00 [INF] Hosting environment: Development
2025-07-09 15:03:29.162 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-09 15:03:29.169 +07:00 [INF] Server digi-tbhh2:9624:b82c55d4 successfully announced in 9.8196 ms
2025-07-09 15:03:29.174 +07:00 [INF] Server digi-tbhh2:9624:b82c55d4 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-09 15:03:29.174 +07:00 [DBG] Execution loop ServerHeartbeatProcess:deed70ce has started in 3.4061 ms
2025-07-09 15:03:29.178 +07:00 [DBG] Execution loop ServerWatchdog:4cbdfea1 has started in 3.137 ms
2025-07-09 15:03:29.181 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:1da17660 has started in 5.157 ms
2025-07-09 15:03:29.184 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:61251ec5 has started in 5.6211 ms
2025-07-09 15:03:29.190 +07:00 [DBG] Execution loop CountersAggregator:5e0fc46d has started in 6.16 ms
2025-07-09 15:03:29.187 +07:00 [DBG] Execution loop ExpirationManager:44d64802 has started in 5.8972 ms
2025-07-09 15:03:29.194 +07:00 [DBG] Execution loop Worker:38b7a455 has started in 5.4689 ms
2025-07-09 15:03:29.201 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 15:03:29.198 +07:00 [DBG] Execution loop Worker:660233dc has started in 9.4079 ms
2025-07-09 15:03:29.220 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-09 15:03:29.201 +07:00 [DBG] Execution loop Worker:f1ccaed8 has started in 12.2872 ms
2025-07-09 15:03:29.203 +07:00 [DBG] Execution loop Worker:fb8640ca has started in 14.6996 ms
2025-07-09 15:03:29.208 +07:00 [DBG] Execution loop Worker:f1d972ba has started in 19.3356 ms
2025-07-09 15:03:29.216 +07:00 [DBG] Execution loop Worker:4a043007 has started in 27.7126 ms
2025-07-09 15:03:29.216 +07:00 [DBG] Execution loop Worker:9be25d03 has started in 27.722 ms
2025-07-09 15:03:29.220 +07:00 [DBG] Execution loop Worker:956b2224 has started in 31.3192 ms
2025-07-09 15:03:29.230 +07:00 [DBG] Execution loop Worker:ec8b32f2 has started in 41.2199 ms
2025-07-09 15:03:29.233 +07:00 [DBG] Execution loop Worker:0bb7451d has started in 44.7199 ms
2025-07-09 15:03:29.239 +07:00 [DBG] Execution loop Worker:c1f58fb3 has started in 50.5374 ms
2025-07-09 15:03:29.242 +07:00 [DBG] Execution loop Worker:57f959ab has started in 53.236 ms
2025-07-09 15:03:29.246 +07:00 [DBG] Execution loop Worker:848a9897 has started in 58.1298 ms
2025-07-09 15:03:29.258 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-09 15:03:29.254 +07:00 [DBG] Execution loop Worker:58d07c1a has started in 65.7544 ms
2025-07-09 15:03:29.257 +07:00 [DBG] Execution loop Worker:89f53041 has started in 68.6636 ms
2025-07-09 15:03:29.262 +07:00 [DBG] Execution loop Worker:be9c3fa0 has started in 73.3117 ms
2025-07-09 15:03:29.282 +07:00 [INF] Server digi-tbhh2:9624:b82c55d4 all the dispatchers started
2025-07-09 15:03:29.280 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-09 15:03:29.264 +07:00 [DBG] Execution loop Worker:77397904 has started in 76.033 ms
2025-07-09 15:03:29.268 +07:00 [DBG] Execution loop Worker:fe0244ba has started in 80.0088 ms
2025-07-09 15:03:29.273 +07:00 [DBG] Execution loop Worker:e6fb64e4 has started in 84.8895 ms
2025-07-09 15:03:29.278 +07:00 [DBG] Execution loop Worker:00ccc275 has started in 89.6279 ms
2025-07-09 15:03:29.284 +07:00 [DBG] Execution loop DelayedJobScheduler:b6e3eeb9 has started in 10.6254 ms
2025-07-09 15:03:29.286 +07:00 [DBG] Execution loop RecurringJobScheduler:18e8e5cf has started in 8.2719 ms
2025-07-09 15:03:29.289 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-09 15:03:29.307 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-09 15:03:29.757 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-09 15:03:29.757 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-09 15:03:29.791 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 38.3653ms
2025-07-09 15:03:29.827 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 75.1782ms
2025-07-09 15:03:29.856 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-09 15:03:29.891 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 34.9106ms
2025-07-09 15:03:59.214 +07:00 [DBG] Server digi-tbhh2:9624:b82c55d4 heartbeat successfully sent
2025-07-09 15:04:12.884 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 584
2025-07-09 15:04:12.908 +07:00 [INF] CORS policy execution failed.
2025-07-09 15:04:12.909 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 15:04:12.914 +07:00 [INF] Request from IP: ::1
2025-07-09 15:04:12.918 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:04:12.937 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 15:04:13.124 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-09 15:04:13.150 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 208.9925ms
2025-07-09 15:04:13.152 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:04:13.155 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 400 288 application/problem+json; charset=utf-8 271.2714ms
2025-07-09 15:04:23.659 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 584
2025-07-09 15:04:23.667 +07:00 [INF] CORS policy execution failed.
2025-07-09 15:04:23.668 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 15:04:23.669 +07:00 [INF] Request from IP: ::1
2025-07-09 15:04:23.669 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:04:23.670 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 15:04:23.677 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-09 15:04:23.831 +07:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 1000), @p2='?' (DbType = DateTime2), @p3='?' (Size = 4000), @p4='?' (Size = 50), @p5='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [RequestLogs] ([CreatedAt], [ErrorMessage], [LastUpdatedAt], [RequestData], [RequestId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-09 15:04:23.903 +07:00 [INF] Enqueued job for RequestId: 826b99b0-23d0-4105-8fe2-4833620038b7
2025-07-09 15:04:23.906 +07:00 [INF] Executing AcceptedResult, writing value of type 'pviBase.Dtos.ApiResponse`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-09 15:04:23.909 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 237.5657ms
2025-07-09 15:04:23.912 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:04:23.928 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 202 99 application/json 269.4219ms
2025-07-09 15:04:24.204 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 15:04:24.221 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0, [Status] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-09 15:04:24.225 +07:00 [INF] Processing job for RequestId: 826b99b0-23d0-4105-8fe2-4833620038b7
2025-07-09 15:04:24.395 +07:00 [INF] Removed cache key: InsuranceContract:19072003
2025-07-09 15:04:24.410 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 15:04:24.415 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0, [Status] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-09 15:04:24.416 +07:00 [INF] Job for RequestId: 826b99b0-23d0-4105-8fe2-4833620038b7 completed successfully.
2025-07-09 15:04:29.223 +07:00 [DBG] Server digi-tbhh2:9624:b82c55d4 heartbeat successfully sent
2025-07-09 15:04:41.999 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - application/json-patch+json 113
2025-07-09 15:04:42.002 +07:00 [INF] CORS policy execution failed.
2025-07-09 15:04:42.003 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 15:04:42.005 +07:00 [INF] Request from IP: ::1
2025-07-09 15:04:42.006 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-09 15:04:42.009 +07:00 [INF] Route matched with {action = "GetContractByLoanNo", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContractByLoanNo(pviBase.Dtos.GetContractByLoanNoRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 15:04:42.017 +07:00 [INF] Received request to get detailed contract for LoanNo: 19072003
2025-07-09 15:04:42.027 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__loanNo_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [i].[Id], [i].[CreatedAt], [i].[CustAddress], [i].[CustBirthday], [i].[CustEmail], [i].[CustGender], [i].[CustIdNo], [i].[CustName], [i].[CustPhone], [i].[DisbursementDate], [i].[InsRate], [i].[LoanAmount], [i].[LoanDate], [i].[LoanNo], [i].[LoanTerm], [i].[LoanType], [i].[UpdatedAt]
FROM [InsuranceContracts] AS [i]
WHERE [i].[LoanNo] = @__loanNo_0
2025-07-09 15:04:42.035 +07:00 [INF] Successfully retrieved detailed contract for LoanNo: 19072003
2025-07-09 15:04:42.036 +07:00 [INF] Executing OkObjectResult, writing value of type 'pviBase.Dtos.GetContractByLoanNoResponseDataDto'.
2025-07-09 15:04:42.041 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase) in 29.9587ms
2025-07-09 15:04:42.042 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-09 15:04:42.050 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - 200 1046 application/json 51.1101ms
2025-07-09 15:04:54.268 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 586
2025-07-09 15:04:54.271 +07:00 [INF] CORS policy execution failed.
2025-07-09 15:04:54.272 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 15:04:54.273 +07:00 [INF] Request from IP: ::1
2025-07-09 15:04:54.273 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:04:54.274 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 15:04:54.277 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-09 15:04:54.282 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 1000), @p2='?' (DbType = DateTime2), @p3='?' (Size = 4000), @p4='?' (Size = 50), @p5='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [RequestLogs] ([CreatedAt], [ErrorMessage], [LastUpdatedAt], [RequestData], [RequestId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-09 15:04:54.292 +07:00 [INF] Enqueued job for RequestId: 776241f2-662b-4973-9f2c-14d2e5b098e0
2025-07-09 15:04:54.293 +07:00 [INF] Executing AcceptedResult, writing value of type 'pviBase.Dtos.ApiResponse`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-09 15:04:54.294 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 18.5572ms
2025-07-09 15:04:54.295 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:04:54.296 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 202 99 application/json 29.4544ms
2025-07-09 15:04:54.305 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 15:04:54.309 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0, [Status] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-09 15:04:54.310 +07:00 [INF] Processing job for RequestId: 776241f2-662b-4973-9f2c-14d2e5b098e0
2025-07-09 15:04:54.312 +07:00 [INF] Removed cache key: InsuranceContract:19072003
2025-07-09 15:04:54.321 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 15:04:54.349 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:04:54.414 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2), @p19='?' (DbType = Int32), @p16='?' (Size = 1000), @p17='?' (DbType = DateTime2), @p18='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
UPDATE [RequestLogs] SET [ErrorMessage] = @p16, [LastUpdatedAt] = @p17, [Status] = @p18
OUTPUT 1
WHERE [Id] = @p19;
2025-07-09 15:04:54.423 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:04:54.463 +07:00 [WRN] Failed to process the job '5': an exception occurred. Retry attempt 1 of 3 will be performed in 00:00:27.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at pviBase.Services.InsuranceService.ProcessCreateInsuranceContractsJob(String requestId, CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 147
   at InvokeStub_TaskAwaiter.GetResult(Object, Object, IntPtr*)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-07-09 15:04:59.248 +07:00 [DBG] Server digi-tbhh2:9624:b82c55d4 heartbeat successfully sent
2025-07-09 15:05:29.254 +07:00 [DBG] Server digi-tbhh2:9624:b82c55d4 heartbeat successfully sent
2025-07-09 15:05:29.443 +07:00 [DBG] 1 scheduled job(s) processed by scheduler.
2025-07-09 15:05:29.449 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 15:05:29.452 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0
OUTPUT 1
WHERE [Id] = @p1;
2025-07-09 15:05:29.454 +07:00 [INF] Processing job for RequestId: 776241f2-662b-4973-9f2c-14d2e5b098e0
2025-07-09 15:05:29.455 +07:00 [INF] Removed cache key: InsuranceContract:19072003
2025-07-09 15:05:29.457 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 15:05:29.462 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:05:29.491 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2), @p19='?' (DbType = Int32), @p16='?' (Size = 1000), @p17='?' (DbType = DateTime2), @p18='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
UPDATE [RequestLogs] SET [ErrorMessage] = @p16, [LastUpdatedAt] = @p17, [Status] = @p18
OUTPUT 1
WHERE [Id] = @p19;
2025-07-09 15:05:29.495 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:05:29.526 +07:00 [WRN] Failed to process the job '5': an exception occurred. Retry attempt 2 of 3 will be performed in 00:00:24.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at pviBase.Services.InsuranceService.ProcessCreateInsuranceContractsJob(String requestId, CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 147
   at InvokeStub_TaskAwaiter.GetResult(Object, Object, IntPtr*)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-07-09 15:05:59.270 +07:00 [DBG] Server digi-tbhh2:9624:b82c55d4 heartbeat successfully sent
2025-07-09 15:05:59.487 +07:00 [DBG] 1 scheduled job(s) processed by scheduler.
2025-07-09 15:05:59.506 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 15:05:59.511 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0
OUTPUT 1
WHERE [Id] = @p1;
2025-07-09 15:05:59.513 +07:00 [INF] Processing job for RequestId: 776241f2-662b-4973-9f2c-14d2e5b098e0
2025-07-09 15:05:59.515 +07:00 [INF] Removed cache key: InsuranceContract:19072003
2025-07-09 15:05:59.517 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 15:05:59.523 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:05:59.558 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2), @p19='?' (DbType = Int32), @p16='?' (Size = 1000), @p17='?' (DbType = DateTime2), @p18='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
UPDATE [RequestLogs] SET [ErrorMessage] = @p16, [LastUpdatedAt] = @p17, [Status] = @p18
OUTPUT 1
WHERE [Id] = @p19;
2025-07-09 15:05:59.563 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:05:59.600 +07:00 [WRN] Failed to process the job '5': an exception occurred. Retry attempt 3 of 3 will be performed in 00:01:58.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ebd89545-3fba-45a1-afeb-76a33447b6ad
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at pviBase.Services.InsuranceService.ProcessCreateInsuranceContractsJob(String requestId, CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 147
   at InvokeStub_TaskAwaiter.GetResult(Object, Object, IntPtr*)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-07-09 15:06:29.277 +07:00 [DBG] Server digi-tbhh2:9624:b82c55d4 heartbeat successfully sent
2025-07-09 15:06:59.285 +07:00 [DBG] Server digi-tbhh2:9624:b82c55d4 heartbeat successfully sent
2025-07-09 15:07:29.305 +07:00 [DBG] Server digi-tbhh2:9624:b82c55d4 heartbeat successfully sent
2025-07-09 15:24:37.845 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 15:24:37.890 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-09 15:24:37.901 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-09 15:24:37.941 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-09 15:24:37.947 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 15:24:37.948 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-09 15:24:37.951 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-09 15:24:37.956 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-09 15:24:37.957 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-09 15:24:38.181 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-09 15:24:38.266 +07:00 [INF] Hangfire SQL objects installed.
2025-07-09 15:24:38.589 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-09 15:24:38.590 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-09 15:24:38.662 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-09 15:24:38.663 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-09 15:24:38.664 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-09 15:24:38.675 +07:00 [DBG] Execution loop BackgroundServerProcess:ad42a453 has started in 6.2793 ms
2025-07-09 15:24:38.683 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-09 15:24:38.685 +07:00 [INF] Hosting environment: Development
2025-07-09 15:24:38.686 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-09 15:24:38.693 +07:00 [INF] Server digi-tbhh2:29868:88bcc6c8 successfully announced in 9.4496 ms
2025-07-09 15:24:38.699 +07:00 [DBG] Execution loop ServerHeartbeatProcess:e2b914b6 has started in 5.2701 ms
2025-07-09 15:24:38.699 +07:00 [INF] Server digi-tbhh2:29868:88bcc6c8 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-09 15:24:38.705 +07:00 [DBG] Execution loop ServerWatchdog:83d1c266 has started in 3.0746 ms
2025-07-09 15:24:38.709 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:52549e31 has started in 5.1389 ms
2025-07-09 15:24:38.712 +07:00 [DBG] Execution loop ExpirationManager:1b20f365 has started in 5.3818 ms
2025-07-09 15:24:38.707 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:d696a252 has started in 5.2643 ms
2025-07-09 15:24:38.715 +07:00 [DBG] Execution loop CountersAggregator:2df1ec57 has started in 5.8438 ms
2025-07-09 15:24:38.725 +07:00 [INF] 2 servers were removed due to timeout
2025-07-09 15:24:38.733 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-09 15:24:38.733 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 15:24:38.718 +07:00 [DBG] Execution loop Worker:8d27c611 has started in 6.434 ms
2025-07-09 15:24:38.721 +07:00 [DBG] Execution loop Worker:3083d0ba has started in 9.3964 ms
2025-07-09 15:24:38.725 +07:00 [DBG] Execution loop Worker:6ce97907 has started in 12.6876 ms
2025-07-09 15:24:38.730 +07:00 [DBG] Execution loop Worker:cf09c37a has started in 18.1109 ms
2025-07-09 15:24:38.732 +07:00 [DBG] Execution loop Worker:bf9eac9d has started in 20.1135 ms
2025-07-09 15:24:38.767 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-09 15:24:38.735 +07:00 [DBG] Execution loop Worker:bb0011c3 has started in 23.3858 ms
2025-07-09 15:24:38.739 +07:00 [DBG] Execution loop Worker:3c4fe67e has started in 26.576 ms
2025-07-09 15:24:38.742 +07:00 [DBG] Execution loop Worker:86551e9f has started in 29.78 ms
2025-07-09 15:24:38.790 +07:00 [INF] Server digi-tbhh2:29868:88bcc6c8 all the dispatchers started
2025-07-09 15:24:38.790 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-09 15:24:38.745 +07:00 [DBG] Execution loop Worker:9d557018 has started in 33.3686 ms
2025-07-09 15:24:38.749 +07:00 [DBG] Execution loop Worker:0ec844f4 has started in 36.6421 ms
2025-07-09 15:24:38.753 +07:00 [DBG] Execution loop Worker:1da8639f has started in 41.0999 ms
2025-07-09 15:24:38.755 +07:00 [DBG] Execution loop Worker:0a7da440 has started in 43.244 ms
2025-07-09 15:24:38.758 +07:00 [DBG] Execution loop Worker:3cc93eb7 has started in 46.4207 ms
2025-07-09 15:24:38.764 +07:00 [DBG] Execution loop Worker:17524b64 has started in 52.1152 ms
2025-07-09 15:24:38.766 +07:00 [DBG] Execution loop Worker:adf51feb has started in 54.1072 ms
2025-07-09 15:24:38.805 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-09 15:24:38.769 +07:00 [DBG] Execution loop Worker:dd004954 has started in 57.2357 ms
2025-07-09 15:24:38.772 +07:00 [DBG] Execution loop Worker:577db9c0 has started in 60.3887 ms
2025-07-09 15:24:38.779 +07:00 [DBG] Execution loop Worker:c36aa15f has started in 65.1119 ms
2025-07-09 15:24:38.781 +07:00 [DBG] Execution loop Worker:bf501e70 has started in 69.4441 ms
2025-07-09 15:24:38.787 +07:00 [DBG] Execution loop Worker:f4cc32be has started in 74.8451 ms
2025-07-09 15:24:38.790 +07:00 [DBG] Execution loop DelayedJobScheduler:31e83b90 has started in 8.4187 ms
2025-07-09 15:24:38.795 +07:00 [DBG] Execution loop RecurringJobScheduler:efaccc19 has started in 9.4228 ms
2025-07-09 15:24:38.808 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-09 15:24:38.989 +07:00 [DBG] 1 scheduled job(s) processed by scheduler.
2025-07-09 15:24:39.327 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-09 15:24:39.327 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-09 15:24:39.365 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 41.5285ms
2025-07-09 15:24:39.403 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 81.6043ms
2025-07-09 15:24:39.425 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 15:24:39.437 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-09 15:24:39.468 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 30.771ms
2025-07-09 15:24:39.545 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0
OUTPUT 1
WHERE [Id] = @p1;
2025-07-09 15:24:39.556 +07:00 [INF] Processing job for RequestId: 776241f2-662b-4973-9f2c-14d2e5b098e0
2025-07-09 15:24:39.804 +07:00 [INF] Removed cache key: InsuranceContract:19072003
2025-07-09 15:24:39.823 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 15:24:39.848 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:61efb6f4-2d90-4465-a7c9-c22ecad6b94c
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:61efb6f4-2d90-4465-a7c9-c22ecad6b94c
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:24:39.906 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2), @p19='?' (DbType = Int32), @p16='?' (Size = 1000), @p17='?' (DbType = DateTime2), @p18='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
UPDATE [RequestLogs] SET [ErrorMessage] = @p16, [LastUpdatedAt] = @p17, [Status] = @p18
OUTPUT 1
WHERE [Id] = @p19;
2025-07-09 15:24:39.913 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:61efb6f4-2d90-4465-a7c9-c22ecad6b94c
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:61efb6f4-2d90-4465-a7c9-c22ecad6b94c
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:24:39.950 +07:00 [ERR] Failed to process the job '5': an exception occurred.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (19072003).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:61efb6f4-2d90-4465-a7c9-c22ecad6b94c
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at pviBase.Services.InsuranceService.ProcessCreateInsuranceContractsJob(String requestId, CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 147
   at System.RuntimeMethodHandle.InvokeMethod(Object target, Void** arguments, Signature sig, Boolean isConstructor)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-07-09 15:24:49.534 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 570
2025-07-09 15:24:49.558 +07:00 [INF] CORS policy execution failed.
2025-07-09 15:24:49.559 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 15:24:49.563 +07:00 [INF] Request from IP: ::1
2025-07-09 15:24:49.565 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:24:49.578 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 15:24:49.646 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 63.6303ms
2025-07-09 15:24:49.648 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:24:49.719 +07:00 [ERR] An unhandled exception has occurred.
FluentValidation.AsyncValidatorInvokedSynchronouslyException: Validator "CreateContractRequestDtoValidator" can't be used with ASP.NET automatic validation as it contains asynchronous rules. ASP.NET's validation pipeline is not asynchronous and can't invoke asynchronous rules. Remove the asynchronous rules in order for this validator to run.
   at FluentValidation.AbstractValidator`1.Validate(ValidationContext`1 context) in /_/src/FluentValidation/AbstractValidator.cs:line 207
   at FluentValidation.AbstractValidator`1.FluentValidation.IValidator.Validate(IValidationContext context) in /_/src/FluentValidation/AbstractValidator.cs:line 153
   at FluentValidation.AspNetCore.FluentValidationModelValidator.Validate(ModelValidationContext mvContext) in /_/src/FluentValidation.AspNetCore/FluentValidationModelValidatorProvider.cs:line 150
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.ValidateNode()
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.VisitComplexType(IValidationStrategy defaultStrategy)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.VisitImplementation(ModelMetadata& metadata, String& key, Object model)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.Visit(ModelMetadata metadata, String key, Object model)
   at FluentValidation.AspNetCore.FluentValidationVisitor.<>n__1(ModelMetadata metadata, String key, Object model, Boolean alwaysValidateAtTopLevel, Object container)
   at FluentValidation.AspNetCore.FluentValidationVisitor.<>c__DisplayClass2_0.<Validate>g__BaseValidate|0() in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 45
   at FluentValidation.AspNetCore.FluentValidationVisitor.ValidateInternal(ModelMetadata metadata, String key, Object model, Func`1 continuation) in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 63
   at FluentValidation.AspNetCore.FluentValidationVisitor.Validate(ModelMetadata metadata, String key, Object model, Boolean alwaysValidateAtTopLevel, Object container) in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 47
   at Microsoft.AspNetCore.Mvc.ModelBinding.ObjectModelValidator.Validate(ActionContext actionContext, ValidationStateDictionary validationState, String prefix, Object model, ModelMetadata metadata, Object container)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.EnforceBindRequiredAndValidate(ObjectModelValidator baseObjectValidator, ActionContext actionContext, ParameterDescriptor parameter, ModelMetadata metadata, ModelBindingContext modelBindingContext, ModelBindingResult modelBindingResult, Object container)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 29
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 28
2025-07-09 15:24:49.770 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 60
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 33
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-09 15:24:49.780 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-09 15:24:49.785 +07:00 [ERR] Connection id "0HNDUO85TQIU3", Request id "0HNDUO85TQIU3:00000007": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 60
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 33
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-09 15:24:49.802 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 268.2386ms
2025-07-09 15:25:01.546 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 570
2025-07-09 15:25:01.554 +07:00 [INF] CORS policy execution failed.
2025-07-09 15:25:01.555 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 15:25:01.556 +07:00 [INF] Request from IP: ::1
2025-07-09 15:25:01.556 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:25:01.557 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 15:25:01.564 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 5.979ms
2025-07-09 15:25:01.566 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:25:01.606 +07:00 [ERR] An unhandled exception has occurred.
FluentValidation.AsyncValidatorInvokedSynchronouslyException: Validator "CreateContractRequestDtoValidator" can't be used with ASP.NET automatic validation as it contains asynchronous rules. ASP.NET's validation pipeline is not asynchronous and can't invoke asynchronous rules. Remove the asynchronous rules in order for this validator to run.
   at FluentValidation.AbstractValidator`1.Validate(ValidationContext`1 context) in /_/src/FluentValidation/AbstractValidator.cs:line 207
   at FluentValidation.AbstractValidator`1.FluentValidation.IValidator.Validate(IValidationContext context) in /_/src/FluentValidation/AbstractValidator.cs:line 153
   at FluentValidation.AspNetCore.FluentValidationModelValidator.Validate(ModelValidationContext mvContext) in /_/src/FluentValidation.AspNetCore/FluentValidationModelValidatorProvider.cs:line 150
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.ValidateNode()
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.VisitComplexType(IValidationStrategy defaultStrategy)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.VisitImplementation(ModelMetadata& metadata, String& key, Object model)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.Visit(ModelMetadata metadata, String key, Object model)
   at FluentValidation.AspNetCore.FluentValidationVisitor.<>n__1(ModelMetadata metadata, String key, Object model, Boolean alwaysValidateAtTopLevel, Object container)
   at FluentValidation.AspNetCore.FluentValidationVisitor.<>c__DisplayClass2_0.<Validate>g__BaseValidate|0() in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 45
   at FluentValidation.AspNetCore.FluentValidationVisitor.ValidateInternal(ModelMetadata metadata, String key, Object model, Func`1 continuation) in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 63
   at FluentValidation.AspNetCore.FluentValidationVisitor.Validate(ModelMetadata metadata, String key, Object model, Boolean alwaysValidateAtTopLevel, Object container) in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 47
   at Microsoft.AspNetCore.Mvc.ModelBinding.ObjectModelValidator.Validate(ActionContext actionContext, ValidationStateDictionary validationState, String prefix, Object model, ModelMetadata metadata, Object container)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.EnforceBindRequiredAndValidate(ObjectModelValidator baseObjectValidator, ActionContext actionContext, ParameterDescriptor parameter, ModelMetadata metadata, ModelBindingContext modelBindingContext, ModelBindingResult modelBindingResult, Object container)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 29
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 28
2025-07-09 15:25:01.646 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 60
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 33
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-09 15:25:01.650 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-09 15:25:01.652 +07:00 [ERR] Connection id "0HNDUO85TQIU3", Request id "0HNDUO85TQIU3:00000009": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 60
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 33
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-09 15:25:01.658 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 111.833ms
2025-07-09 15:25:08.724 +07:00 [DBG] Server digi-tbhh2:29868:88bcc6c8 heartbeat successfully sent
2025-07-09 15:25:11.432 +07:00 [DBG] Hangfire Server is stopping...
2025-07-09 15:25:11.434 +07:00 [INF] Server digi-tbhh2:29868:88bcc6c8 caught stopping signal...
2025-07-09 15:25:11.437 +07:00 [DBG] Execution loop ExpirationManager:1b20f365 stopped in 0 ms
2025-07-09 15:25:11.437 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:d696a252 stopped in 0 ms
2025-07-09 15:25:11.439 +07:00 [DBG] Execution loop ServerWatchdog:83d1c266 stopped in 0.2962 ms
2025-07-09 15:25:11.439 +07:00 [DBG] Execution loop CountersAggregator:2df1ec57 stopped in 0.0092 ms
2025-07-09 15:25:11.438 +07:00 [DBG] Execution loop Worker:8d27c611 stopped in 0 ms
2025-07-09 15:25:11.438 +07:00 [DBG] Execution loop Worker:3083d0ba stopped in 0 ms
2025-07-09 15:25:11.438 +07:00 [DBG] Execution loop Worker:6ce97907 stopped in 0 ms
2025-07-09 15:25:11.438 +07:00 [DBG] Execution loop Worker:cf09c37a stopped in 0 ms
2025-07-09 15:25:11.438 +07:00 [DBG] Execution loop Worker:bf9eac9d stopped in 0 ms
2025-07-09 15:25:11.438 +07:00 [DBG] Execution loop Worker:bb0011c3 stopped in 0 ms
2025-07-09 15:25:11.439 +07:00 [DBG] Execution loop Worker:3c4fe67e stopped in 0 ms
2025-07-09 15:25:11.439 +07:00 [DBG] Execution loop Worker:86551e9f stopped in 0 ms
2025-07-09 15:25:11.438 +07:00 [DBG] Execution loop Worker:9d557018 stopped in 0 ms
2025-07-09 15:25:11.438 +07:00 [DBG] Execution loop Worker:0ec844f4 stopped in 0 ms
2025-07-09 15:25:11.439 +07:00 [DBG] Execution loop Worker:1da8639f stopped in 0 ms
2025-07-09 15:25:11.439 +07:00 [DBG] Execution loop Worker:0a7da440 stopped in 0 ms
2025-07-09 15:25:11.439 +07:00 [DBG] Execution loop Worker:3cc93eb7 stopped in 0 ms
2025-07-09 15:25:11.439 +07:00 [DBG] Execution loop Worker:17524b64 stopped in 0 ms
2025-07-09 15:25:11.439 +07:00 [DBG] Execution loop Worker:adf51feb stopped in 0 ms
2025-07-09 15:25:11.439 +07:00 [DBG] Execution loop Worker:dd004954 stopped in 0 ms
2025-07-09 15:25:11.439 +07:00 [DBG] Execution loop Worker:577db9c0 stopped in 0 ms
2025-07-09 15:25:11.439 +07:00 [DBG] Execution loop Worker:c36aa15f stopped in 0 ms
2025-07-09 15:25:11.439 +07:00 [DBG] Execution loop Worker:bf501e70 stopped in 0 ms
2025-07-09 15:25:11.443 +07:00 [DBG] Execution loop Worker:f4cc32be stopped in 4.2694 ms
2025-07-09 15:25:11.437 +07:00 [DBG] Execution loop DelayedJobScheduler:31e83b90 stopped in 0 ms
2025-07-09 15:25:11.437 +07:00 [DBG] Execution loop RecurringJobScheduler:efaccc19 stopped in 0 ms
2025-07-09 15:25:11.441 +07:00 [INF] Application is shutting down...
2025-07-09 15:25:11.567 +07:00 [DBG] Hangfire Server is stopping...
2025-07-09 15:25:12.008 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:52549e31 stopped in 568.4936 ms
2025-07-09 15:25:12.012 +07:00 [INF] Server digi-tbhh2:29868:88bcc6c8 All dispatchers stopped
2025-07-09 15:25:12.016 +07:00 [DBG] Execution loop ServerHeartbeatProcess:e2b914b6 stopped in 0.5177 ms
2025-07-09 15:25:12.022 +07:00 [INF] Server digi-tbhh2:29868:88bcc6c8 successfully reported itself as stopped in 2.4507 ms
2025-07-09 15:25:12.023 +07:00 [INF] Server digi-tbhh2:29868:88bcc6c8 has been stopped in total 583.3504 ms
2025-07-09 15:25:12.024 +07:00 [DBG] Execution loop BackgroundServerProcess:ad42a453 stopped in 584.3999 ms
2025-07-09 15:41:13.490 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 15:41:13.548 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-09 15:41:13.560 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-09 15:41:13.602 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-09 15:41:13.609 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 15:41:13.611 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-09 15:41:13.614 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-09 15:41:13.619 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-09 15:41:13.621 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-09 15:41:13.882 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-09 15:41:14.244 +07:00 [INF] Hangfire SQL objects installed.
2025-07-09 15:41:14.620 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-09 15:41:14.621 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-09 15:41:14.794 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-09 15:41:14.795 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-09 15:41:14.796 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-09 15:41:14.806 +07:00 [DBG] Execution loop BackgroundServerProcess:f234ffe9 has started in 5.3796 ms
2025-07-09 15:41:14.813 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-09 15:41:14.814 +07:00 [INF] Hosting environment: Development
2025-07-09 15:41:14.815 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-09 15:41:14.823 +07:00 [INF] Server digi-tbhh2:32100:57ba347b successfully announced in 9.8677 ms
2025-07-09 15:41:14.829 +07:00 [DBG] Execution loop ServerHeartbeatProcess:aa2797e2 has started in 4.1736 ms
2025-07-09 15:41:14.829 +07:00 [INF] Server digi-tbhh2:32100:57ba347b is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-09 15:41:14.834 +07:00 [DBG] Execution loop ServerWatchdog:6a5f836f has started in 2.9691 ms
2025-07-09 15:41:14.837 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:76f8badb has started in 5.7748 ms
2025-07-09 15:41:14.841 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:899e05ed has started in 7.528 ms
2025-07-09 15:41:14.843 +07:00 [DBG] Execution loop ExpirationManager:bfa734de has started in 5.9289 ms
2025-07-09 15:41:14.845 +07:00 [DBG] Execution loop CountersAggregator:ae67d672 has started in 4.3299 ms
2025-07-09 15:41:14.848 +07:00 [DBG] Execution loop Worker:3d5e5818 has started in 5.4371 ms
2025-07-09 15:41:14.859 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 15:41:14.852 +07:00 [DBG] Execution loop Worker:53e1d9bb has started in 8.5983 ms
2025-07-09 15:41:14.864 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-09 15:41:14.855 +07:00 [DBG] Execution loop Worker:732cd827 has started in 11.9424 ms
2025-07-09 15:41:14.858 +07:00 [DBG] Execution loop Worker:7a59d437 has started in 14.6487 ms
2025-07-09 15:41:14.860 +07:00 [DBG] Execution loop Worker:35fb1544 has started in 17.2894 ms
2025-07-09 15:41:14.863 +07:00 [DBG] Execution loop Worker:41c917dd has started in 19.8503 ms
2025-07-09 15:41:14.866 +07:00 [DBG] Execution loop Worker:93664d53 has started in 22.8585 ms
2025-07-09 15:41:14.872 +07:00 [DBG] Execution loop Worker:aaadde73 has started in 29.0844 ms
2025-07-09 15:41:14.869 +07:00 [DBG] Execution loop Worker:904a375a has started in 25.5897 ms
2025-07-09 15:41:14.875 +07:00 [DBG] Execution loop Worker:5431137f has started in 31.8811 ms
2025-07-09 15:41:14.878 +07:00 [DBG] Execution loop Worker:b9e6a5c7 has started in 34.9027 ms
2025-07-09 15:41:14.911 +07:00 [INF] Server digi-tbhh2:32100:57ba347b all the dispatchers started
2025-07-09 15:41:14.881 +07:00 [DBG] Execution loop Worker:474693ff has started in 37.9123 ms
2025-07-09 15:41:14.885 +07:00 [DBG] Execution loop Worker:b3a88c44 has started in 42.1582 ms
2025-07-09 15:41:14.888 +07:00 [DBG] Execution loop Worker:c94a03be has started in 44.5594 ms
2025-07-09 15:41:14.891 +07:00 [DBG] Execution loop Worker:324c787b has started in 47.8582 ms
2025-07-09 15:41:14.894 +07:00 [DBG] Execution loop Worker:4fd822c0 has started in 50.9418 ms
2025-07-09 15:41:14.897 +07:00 [DBG] Execution loop Worker:77fdd48f has started in 54.2257 ms
2025-07-09 15:41:14.916 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-09 15:41:14.901 +07:00 [DBG] Execution loop Worker:6eccd1ad has started in 57.803 ms
2025-07-09 15:41:14.905 +07:00 [DBG] Execution loop Worker:5fbcef1a has started in 61.5173 ms
2025-07-09 15:41:14.909 +07:00 [DBG] Execution loop Worker:7bce562b has started in 65.9765 ms
2025-07-09 15:41:14.911 +07:00 [DBG] Execution loop DelayedJobScheduler:e83dcfb0 has started in 6.7163 ms
2025-07-09 15:41:14.915 +07:00 [DBG] Execution loop RecurringJobScheduler:ef96c345 has started in 6.8371 ms
2025-07-09 15:41:14.927 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-09 15:41:14.929 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-09 15:41:14.935 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-09 15:41:15.616 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-09 15:41:15.616 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-09 15:41:15.647 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 38.2935ms
2025-07-09 15:41:15.685 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 76.5407ms
2025-07-09 15:41:15.717 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-09 15:41:15.758 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 41.1192ms
2025-07-09 15:41:36.685 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 568
2025-07-09 15:41:36.711 +07:00 [INF] CORS policy execution failed.
2025-07-09 15:41:36.712 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 15:41:36.714 +07:00 [INF] Request from IP: ::1
2025-07-09 15:41:36.718 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:41:36.739 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 15:41:36.918 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 175.5057ms
2025-07-09 15:41:36.922 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:41:36.986 +07:00 [ERR] An unhandled exception has occurred.
FluentValidation.AsyncValidatorInvokedSynchronouslyException: Validator "CreateContractRequestDtoValidator" can't be used with ASP.NET automatic validation as it contains asynchronous rules. ASP.NET's validation pipeline is not asynchronous and can't invoke asynchronous rules. Remove the asynchronous rules in order for this validator to run.
   at FluentValidation.AbstractValidator`1.Validate(ValidationContext`1 context) in /_/src/FluentValidation/AbstractValidator.cs:line 207
   at FluentValidation.AbstractValidator`1.FluentValidation.IValidator.Validate(IValidationContext context) in /_/src/FluentValidation/AbstractValidator.cs:line 153
   at FluentValidation.AspNetCore.FluentValidationModelValidator.Validate(ModelValidationContext mvContext) in /_/src/FluentValidation.AspNetCore/FluentValidationModelValidatorProvider.cs:line 150
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.ValidateNode()
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.VisitComplexType(IValidationStrategy defaultStrategy)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.VisitImplementation(ModelMetadata& metadata, String& key, Object model)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.Visit(ModelMetadata metadata, String key, Object model)
   at FluentValidation.AspNetCore.FluentValidationVisitor.<>n__1(ModelMetadata metadata, String key, Object model, Boolean alwaysValidateAtTopLevel, Object container)
   at FluentValidation.AspNetCore.FluentValidationVisitor.<>c__DisplayClass2_0.<Validate>g__BaseValidate|0() in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 45
   at FluentValidation.AspNetCore.FluentValidationVisitor.ValidateInternal(ModelMetadata metadata, String key, Object model, Func`1 continuation) in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 63
   at FluentValidation.AspNetCore.FluentValidationVisitor.Validate(ModelMetadata metadata, String key, Object model, Boolean alwaysValidateAtTopLevel, Object container) in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 47
   at Microsoft.AspNetCore.Mvc.ModelBinding.ObjectModelValidator.Validate(ActionContext actionContext, ValidationStateDictionary validationState, String prefix, Object model, ModelMetadata metadata, Object container)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.EnforceBindRequiredAndValidate(ObjectModelValidator baseObjectValidator, ActionContext actionContext, ParameterDescriptor parameter, ModelMetadata metadata, ModelBindingContext modelBindingContext, ModelBindingResult modelBindingResult, Object container)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 29
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 28
2025-07-09 15:41:37.080 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 60
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 33
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-09 15:41:37.088 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-09 15:41:37.093 +07:00 [ERR] Connection id "0HNDUOHEQ96U7", Request id "0HNDUOHEQ96U7:00000007": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 60
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 33
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-09 15:41:37.108 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 422.4447ms
2025-07-09 15:41:42.675 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 569
2025-07-09 15:41:42.680 +07:00 [INF] CORS policy execution failed.
2025-07-09 15:41:42.681 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 15:41:42.682 +07:00 [INF] Request from IP: ::1
2025-07-09 15:41:42.683 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:41:42.684 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 15:41:42.692 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 6.8027ms
2025-07-09 15:41:42.693 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:41:42.738 +07:00 [ERR] An unhandled exception has occurred.
FluentValidation.AsyncValidatorInvokedSynchronouslyException: Validator "CreateContractRequestDtoValidator" can't be used with ASP.NET automatic validation as it contains asynchronous rules. ASP.NET's validation pipeline is not asynchronous and can't invoke asynchronous rules. Remove the asynchronous rules in order for this validator to run.
   at FluentValidation.AbstractValidator`1.Validate(ValidationContext`1 context) in /_/src/FluentValidation/AbstractValidator.cs:line 207
   at FluentValidation.AbstractValidator`1.FluentValidation.IValidator.Validate(IValidationContext context) in /_/src/FluentValidation/AbstractValidator.cs:line 153
   at FluentValidation.AspNetCore.FluentValidationModelValidator.Validate(ModelValidationContext mvContext) in /_/src/FluentValidation.AspNetCore/FluentValidationModelValidatorProvider.cs:line 150
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.ValidateNode()
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.VisitComplexType(IValidationStrategy defaultStrategy)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.VisitImplementation(ModelMetadata& metadata, String& key, Object model)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.Visit(ModelMetadata metadata, String key, Object model)
   at FluentValidation.AspNetCore.FluentValidationVisitor.<>n__1(ModelMetadata metadata, String key, Object model, Boolean alwaysValidateAtTopLevel, Object container)
   at FluentValidation.AspNetCore.FluentValidationVisitor.<>c__DisplayClass2_0.<Validate>g__BaseValidate|0() in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 45
   at FluentValidation.AspNetCore.FluentValidationVisitor.ValidateInternal(ModelMetadata metadata, String key, Object model, Func`1 continuation) in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 63
   at FluentValidation.AspNetCore.FluentValidationVisitor.Validate(ModelMetadata metadata, String key, Object model, Boolean alwaysValidateAtTopLevel, Object container) in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 47
   at Microsoft.AspNetCore.Mvc.ModelBinding.ObjectModelValidator.Validate(ActionContext actionContext, ValidationStateDictionary validationState, String prefix, Object model, ModelMetadata metadata, Object container)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.EnforceBindRequiredAndValidate(ObjectModelValidator baseObjectValidator, ActionContext actionContext, ParameterDescriptor parameter, ModelMetadata metadata, ModelBindingContext modelBindingContext, ModelBindingResult modelBindingResult, Object container)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 29
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 28
2025-07-09 15:41:42.774 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 60
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 33
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-09 15:41:42.778 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-09 15:41:42.780 +07:00 [ERR] Connection id "0HNDUOHEQ96U7", Request id "0HNDUOHEQ96U7:00000009": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 60
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 33
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-09 15:41:42.784 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 108.6193ms
2025-07-09 15:41:44.849 +07:00 [DBG] Server digi-tbhh2:32100:57ba347b heartbeat successfully sent
2025-07-09 15:42:14.853 +07:00 [DBG] Server digi-tbhh2:32100:57ba347b heartbeat successfully sent
2025-07-09 15:42:44.873 +07:00 [DBG] Server digi-tbhh2:32100:57ba347b heartbeat successfully sent
2025-07-09 15:53:55.259 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 15:53:55.314 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-09 15:53:55.327 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-09 15:53:55.383 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-09 15:53:55.391 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-09 15:53:55.393 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-09 15:53:55.397 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-09 15:53:55.403 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-09 15:53:55.405 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-09 15:53:55.640 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-09 15:53:55.726 +07:00 [INF] Hangfire SQL objects installed.
2025-07-09 15:53:56.075 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-09 15:53:56.075 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-09 15:53:56.149 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-09 15:53:56.150 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-09 15:53:56.150 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-09 15:53:56.161 +07:00 [DBG] Execution loop BackgroundServerProcess:436fa7a6 has started in 5.2971 ms
2025-07-09 15:53:56.168 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-09 15:53:56.169 +07:00 [INF] Hosting environment: Development
2025-07-09 15:53:56.175 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-09 15:53:56.182 +07:00 [INF] Server digi-tbhh2:1208:2695a079 successfully announced in 14.3341 ms
2025-07-09 15:53:56.188 +07:00 [INF] Server digi-tbhh2:1208:2695a079 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-09 15:53:56.188 +07:00 [DBG] Execution loop ServerHeartbeatProcess:69501e80 has started in 4.923 ms
2025-07-09 15:53:56.193 +07:00 [DBG] Execution loop ServerWatchdog:0cb1b31e has started in 3.5331 ms
2025-07-09 15:53:56.198 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:b1e8624c has started in 8.1357 ms
2025-07-09 15:53:56.200 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:b357cfc6 has started in 7.1819 ms
2025-07-09 15:53:56.203 +07:00 [DBG] Execution loop ExpirationManager:ac1d12b1 has started in 6.3784 ms
2025-07-09 15:53:56.206 +07:00 [DBG] Execution loop CountersAggregator:6476002c has started in 6.0295 ms
2025-07-09 15:53:56.213 +07:00 [INF] 1 servers were removed due to timeout
2025-07-09 15:53:56.218 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-09 15:53:56.221 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-09 15:53:56.228 +07:00 [DBG] Execution loop Worker:64f31c74 has started in 24.8203 ms
2025-07-09 15:53:56.210 +07:00 [DBG] Execution loop Worker:5101abe2 has started in 6.7786 ms
2025-07-09 15:53:56.213 +07:00 [DBG] Execution loop Worker:d25c0d8e has started in 9.9734 ms
2025-07-09 15:53:56.216 +07:00 [DBG] Execution loop Worker:2f99b771 has started in 13.0055 ms
2025-07-09 15:53:56.220 +07:00 [DBG] Execution loop Worker:c406ccd4 has started in 16.2566 ms
2025-07-09 15:53:56.222 +07:00 [DBG] Execution loop Worker:611eeaac has started in 19.0519 ms
2025-07-09 15:53:56.225 +07:00 [DBG] Execution loop Worker:6698f5e9 has started in 22.0936 ms
2025-07-09 15:53:56.265 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-09 15:53:56.231 +07:00 [DBG] Execution loop Worker:8f836739 has started in 27.6343 ms
2025-07-09 15:53:56.234 +07:00 [DBG] Execution loop Worker:da24e708 has started in 30.3903 ms
2025-07-09 15:53:56.237 +07:00 [DBG] Execution loop Worker:ce3fab65 has started in 33.4809 ms
2025-07-09 15:53:56.240 +07:00 [DBG] Execution loop Worker:f403bae1 has started in 36.5498 ms
2025-07-09 15:53:56.250 +07:00 [DBG] Execution loop Worker:25f84bb9 has started in 46.2503 ms
2025-07-09 15:53:56.254 +07:00 [DBG] Execution loop Worker:b9e7a6d9 has started in 50.6248 ms
2025-07-09 15:53:56.263 +07:00 [DBG] Execution loop Worker:4b986d93 has started in 59.7248 ms
2025-07-09 15:53:56.599 +07:00 [INF] Server digi-tbhh2:1208:2695a079 all the dispatchers started
2025-07-09 15:53:56.267 +07:00 [DBG] Execution loop Worker:29c01f4b has started in 64.1299 ms
2025-07-09 15:53:56.273 +07:00 [DBG] Execution loop Worker:bc8fd729 has started in 69.0926 ms
2025-07-09 15:53:56.277 +07:00 [DBG] Execution loop Worker:22cea282 has started in 73.2041 ms
2025-07-09 15:53:56.281 +07:00 [DBG] Execution loop Worker:9493ffa2 has started in 77.0876 ms
2025-07-09 15:53:56.284 +07:00 [DBG] Execution loop Worker:5f058219 has started in 81.0258 ms
2025-07-09 15:53:56.496 +07:00 [DBG] Execution loop Worker:96c78118 has started in 292.6038 ms
2025-07-09 15:53:56.607 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-09 15:53:56.594 +07:00 [DBG] Execution loop DelayedJobScheduler:b0a58b84 has started in 310.1184 ms
2025-07-09 15:53:56.604 +07:00 [DBG] Execution loop RecurringJobScheduler:ec031741 has started in 109.1103 ms
2025-07-09 15:53:56.620 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-09 15:53:56.625 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-09 15:53:56.789 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-09 15:53:56.789 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-09 15:53:56.824 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 34.7469ms
2025-07-09 15:53:56.866 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 85.0101ms
2025-07-09 15:53:56.896 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-09 15:53:56.928 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 31.9834ms
2025-07-09 15:54:06.675 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 570
2025-07-09 15:54:06.697 +07:00 [INF] CORS policy execution failed.
2025-07-09 15:54:06.698 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 15:54:06.700 +07:00 [INF] Request from IP: ::1
2025-07-09 15:54:06.703 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:54:06.721 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 15:54:06.876 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-09 15:54:07.022 +07:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 1000), @p2='?' (DbType = DateTime2), @p3='?' (Size = 4000), @p4='?' (Size = 50), @p5='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [RequestLogs] ([CreatedAt], [ErrorMessage], [LastUpdatedAt], [RequestData], [RequestId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-09 15:54:07.114 +07:00 [INF] Enqueued job for RequestId: 3d3fefad-84b5-4823-b789-10e9905c98f4
2025-07-09 15:54:07.123 +07:00 [INF] Executing AcceptedResult, writing value of type 'pviBase.Middlewares.ApiResponse`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-09 15:54:07.142 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 417.1147ms
2025-07-09 15:54:07.143 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:54:07.152 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 202 99 application/json 478.0504ms
2025-07-09 15:54:07.433 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 15:54:07.451 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0, [Status] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-09 15:54:07.455 +07:00 [INF] Processing job for RequestId: 3d3fefad-84b5-4823-b789-10e9905c98f4
2025-07-09 15:54:07.684 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-09 15:54:07.697 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 15:54:07.702 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0, [Status] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-09 15:54:07.704 +07:00 [INF] Job for RequestId: 3d3fefad-84b5-4823-b789-10e9905c98f4 completed successfully.
2025-07-09 15:54:14.200 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 570
2025-07-09 15:54:14.205 +07:00 [INF] CORS policy execution failed.
2025-07-09 15:54:14.206 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 15:54:14.206 +07:00 [INF] Request from IP: ::1
2025-07-09 15:54:14.207 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:54:14.208 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 15:54:14.213 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-09 15:54:14.218 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 1000), @p2='?' (DbType = DateTime2), @p3='?' (Size = 4000), @p4='?' (Size = 50), @p5='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [RequestLogs] ([CreatedAt], [ErrorMessage], [LastUpdatedAt], [RequestData], [RequestId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-09 15:54:14.228 +07:00 [INF] Enqueued job for RequestId: 382e51d8-f36d-49dd-a97b-f75f40900d09
2025-07-09 15:54:14.229 +07:00 [INF] Executing AcceptedResult, writing value of type 'pviBase.Middlewares.ApiResponse`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-09 15:54:14.231 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 21.7705ms
2025-07-09 15:54:14.232 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:54:14.233 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 202 99 application/json 34.3013ms
2025-07-09 15:54:14.239 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 15:54:14.242 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0, [Status] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-09 15:54:14.244 +07:00 [INF] Processing job for RequestId: 382e51d8-f36d-49dd-a97b-f75f40900d09
2025-07-09 15:54:14.245 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-09 15:54:14.248 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 15:54:14.281 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8c08cda-dade-4a10-b874-5b4f15f355f8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8c08cda-dade-4a10-b874-5b4f15f355f8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:54:14.358 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2), @p19='?' (DbType = Int32), @p16='?' (Size = 1000), @p17='?' (DbType = DateTime2), @p18='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
UPDATE [RequestLogs] SET [ErrorMessage] = @p16, [LastUpdatedAt] = @p17, [Status] = @p18
OUTPUT 1
WHERE [Id] = @p19;
2025-07-09 15:54:14.364 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8c08cda-dade-4a10-b874-5b4f15f355f8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8c08cda-dade-4a10-b874-5b4f15f355f8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:54:14.403 +07:00 [WRN] Failed to process the job '7': an exception occurred. Retry attempt 1 of 3 will be performed in 00:00:16.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8c08cda-dade-4a10-b874-5b4f15f355f8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at pviBase.Services.InsuranceService.ProcessCreateInsuranceContractsJob(String requestId, CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 147
   at InvokeStub_TaskAwaiter.GetResult(Object, Object, IntPtr*)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-07-09 15:54:22.578 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 570
2025-07-09 15:54:22.586 +07:00 [INF] CORS policy execution failed.
2025-07-09 15:54:22.587 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-09 15:54:22.588 +07:00 [INF] Request from IP: ::1
2025-07-09 15:54:22.589 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:54:22.590 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-09 15:54:22.594 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-09 15:54:22.598 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 1000), @p2='?' (DbType = DateTime2), @p3='?' (Size = 4000), @p4='?' (Size = 50), @p5='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [RequestLogs] ([CreatedAt], [ErrorMessage], [LastUpdatedAt], [RequestData], [RequestId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-09 15:54:22.608 +07:00 [INF] Enqueued job for RequestId: 91858afd-e147-4989-926d-a98bc773ea22
2025-07-09 15:54:22.609 +07:00 [INF] Executing AcceptedResult, writing value of type 'pviBase.Middlewares.ApiResponse`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-09 15:54:22.611 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 19.5689ms
2025-07-09 15:54:22.612 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-09 15:54:22.613 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 202 99 application/json 35.3511ms
2025-07-09 15:54:22.624 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 15:54:22.627 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0, [Status] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-09 15:54:22.629 +07:00 [INF] Processing job for RequestId: 91858afd-e147-4989-926d-a98bc773ea22
2025-07-09 15:54:22.630 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-09 15:54:22.633 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 15:54:22.637 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9750d60e-6519-4a48-8393-5cb74344a991
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9750d60e-6519-4a48-8393-5cb74344a991
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:54:22.674 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2), @p19='?' (DbType = Int32), @p16='?' (Size = 1000), @p17='?' (DbType = DateTime2), @p18='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
UPDATE [RequestLogs] SET [ErrorMessage] = @p16, [LastUpdatedAt] = @p17, [Status] = @p18
OUTPUT 1
WHERE [Id] = @p19;
2025-07-09 15:54:22.679 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9750d60e-6519-4a48-8393-5cb74344a991
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9750d60e-6519-4a48-8393-5cb74344a991
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:54:22.715 +07:00 [WRN] Failed to process the job '8': an exception occurred. Retry attempt 1 of 3 will be performed in 00:00:27.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9750d60e-6519-4a48-8393-5cb74344a991
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at pviBase.Services.InsuranceService.ProcessCreateInsuranceContractsJob(String requestId, CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 147
   at InvokeStub_TaskAwaiter.GetResult(Object, Object, IntPtr*)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-07-09 15:54:26.222 +07:00 [DBG] Server digi-tbhh2:1208:2695a079 heartbeat successfully sent
2025-07-09 15:54:41.679 +07:00 [DBG] 1 scheduled job(s) processed by scheduler.
2025-07-09 15:54:41.685 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 15:54:41.688 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0
OUTPUT 1
WHERE [Id] = @p1;
2025-07-09 15:54:41.690 +07:00 [INF] Processing job for RequestId: 382e51d8-f36d-49dd-a97b-f75f40900d09
2025-07-09 15:54:41.691 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-09 15:54:41.693 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 15:54:41.697 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8c08cda-dade-4a10-b874-5b4f15f355f8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8c08cda-dade-4a10-b874-5b4f15f355f8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:54:41.731 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2), @p19='?' (DbType = Int32), @p16='?' (Size = 1000), @p17='?' (DbType = DateTime2), @p18='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
UPDATE [RequestLogs] SET [ErrorMessage] = @p16, [LastUpdatedAt] = @p17, [Status] = @p18
OUTPUT 1
WHERE [Id] = @p19;
2025-07-09 15:54:41.734 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8c08cda-dade-4a10-b874-5b4f15f355f8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8c08cda-dade-4a10-b874-5b4f15f355f8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:54:41.763 +07:00 [WRN] Failed to process the job '7': an exception occurred. Retry attempt 2 of 3 will be performed in 00:00:58.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8c08cda-dade-4a10-b874-5b4f15f355f8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at pviBase.Services.InsuranceService.ProcessCreateInsuranceContractsJob(String requestId, CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 147
   at InvokeStub_TaskAwaiter.GetResult(Object, Object, IntPtr*)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-07-09 15:54:56.240 +07:00 [DBG] Server digi-tbhh2:1208:2695a079 heartbeat successfully sent
2025-07-09 15:54:56.698 +07:00 [DBG] 1 scheduled job(s) processed by scheduler.
2025-07-09 15:54:56.710 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 15:54:56.713 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0
OUTPUT 1
WHERE [Id] = @p1;
2025-07-09 15:54:56.714 +07:00 [INF] Processing job for RequestId: 91858afd-e147-4989-926d-a98bc773ea22
2025-07-09 15:54:56.716 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-09 15:54:56.718 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 15:54:56.723 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9750d60e-6519-4a48-8393-5cb74344a991
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9750d60e-6519-4a48-8393-5cb74344a991
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:54:56.755 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2), @p19='?' (DbType = Int32), @p16='?' (Size = 1000), @p17='?' (DbType = DateTime2), @p18='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
UPDATE [RequestLogs] SET [ErrorMessage] = @p16, [LastUpdatedAt] = @p17, [Status] = @p18
OUTPUT 1
WHERE [Id] = @p19;
2025-07-09 15:54:56.760 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9750d60e-6519-4a48-8393-5cb74344a991
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9750d60e-6519-4a48-8393-5cb74344a991
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:54:56.793 +07:00 [WRN] Failed to process the job '8': an exception occurred. Retry attempt 2 of 3 will be performed in 00:00:16.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9750d60e-6519-4a48-8393-5cb74344a991
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at pviBase.Services.InsuranceService.ProcessCreateInsuranceContractsJob(String requestId, CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 147
   at InvokeStub_TaskAwaiter.GetResult(Object, Object, IntPtr*)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-07-09 15:55:26.253 +07:00 [DBG] Server digi-tbhh2:1208:2695a079 heartbeat successfully sent
2025-07-09 15:55:26.725 +07:00 [DBG] 1 scheduled job(s) processed by scheduler.
2025-07-09 15:55:26.731 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 15:55:26.734 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0
OUTPUT 1
WHERE [Id] = @p1;
2025-07-09 15:55:26.736 +07:00 [INF] Processing job for RequestId: 91858afd-e147-4989-926d-a98bc773ea22
2025-07-09 15:55:26.737 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-09 15:55:26.740 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 15:55:26.744 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:55:26.774 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2), @p19='?' (DbType = Int32), @p16='?' (Size = 1000), @p17='?' (DbType = DateTime2), @p18='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
UPDATE [RequestLogs] SET [ErrorMessage] = @p16, [LastUpdatedAt] = @p17, [Status] = @p18
OUTPUT 1
WHERE [Id] = @p19;
2025-07-09 15:55:26.778 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:55:26.808 +07:00 [WRN] Failed to process the job '8': an exception occurred. Retry attempt 3 of 3 will be performed in 00:01:16.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at pviBase.Services.InsuranceService.ProcessCreateInsuranceContractsJob(String requestId, CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 147
   at InvokeStub_TaskAwaiter.GetResult(Object, Object, IntPtr*)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-07-09 15:55:41.739 +07:00 [DBG] 1 scheduled job(s) processed by scheduler.
2025-07-09 15:55:41.745 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 15:55:41.749 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0
OUTPUT 1
WHERE [Id] = @p1;
2025-07-09 15:55:41.751 +07:00 [INF] Processing job for RequestId: 382e51d8-f36d-49dd-a97b-f75f40900d09
2025-07-09 15:55:41.753 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-09 15:55:41.755 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 15:55:41.759 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:55:41.788 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2), @p19='?' (DbType = Int32), @p16='?' (Size = 1000), @p17='?' (DbType = DateTime2), @p18='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
UPDATE [RequestLogs] SET [ErrorMessage] = @p16, [LastUpdatedAt] = @p17, [Status] = @p18
OUTPUT 1
WHERE [Id] = @p19;
2025-07-09 15:55:41.791 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:55:41.820 +07:00 [WRN] Failed to process the job '7': an exception occurred. Retry attempt 3 of 3 will be performed in 00:01:31.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at pviBase.Services.InsuranceService.ProcessCreateInsuranceContractsJob(String requestId, CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 147
   at InvokeStub_TaskAwaiter.GetResult(Object, Object, IntPtr*)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-07-09 15:55:56.265 +07:00 [DBG] Server digi-tbhh2:1208:2695a079 heartbeat successfully sent
2025-07-09 15:56:26.270 +07:00 [DBG] Server digi-tbhh2:1208:2695a079 heartbeat successfully sent
2025-07-09 15:56:56.279 +07:00 [DBG] Server digi-tbhh2:1208:2695a079 heartbeat successfully sent
2025-07-09 15:56:56.799 +07:00 [DBG] 1 scheduled job(s) processed by scheduler.
2025-07-09 15:56:56.806 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 15:56:56.809 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0
OUTPUT 1
WHERE [Id] = @p1;
2025-07-09 15:56:56.810 +07:00 [INF] Processing job for RequestId: 91858afd-e147-4989-926d-a98bc773ea22
2025-07-09 15:56:56.811 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-09 15:56:56.814 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 15:56:56.818 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:56:56.845 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2), @p19='?' (DbType = Int32), @p16='?' (Size = 1000), @p17='?' (DbType = DateTime2), @p18='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
UPDATE [RequestLogs] SET [ErrorMessage] = @p16, [LastUpdatedAt] = @p17, [Status] = @p18
OUTPUT 1
WHERE [Id] = @p19;
2025-07-09 15:56:56.849 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:56:56.876 +07:00 [ERR] Failed to process the job '8': an exception occurred.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ab87e047-f5d0-4b15-a892-aaff5f5aa999
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at pviBase.Services.InsuranceService.ProcessCreateInsuranceContractsJob(String requestId, CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 147
   at InvokeStub_TaskAwaiter.GetResult(Object, Object, IntPtr*)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-07-09 15:57:26.289 +07:00 [DBG] Server digi-tbhh2:1208:2695a079 heartbeat successfully sent
2025-07-09 15:57:26.831 +07:00 [DBG] 1 scheduled job(s) processed by scheduler.
2025-07-09 15:57:26.844 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-09 15:57:26.847 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0
OUTPUT 1
WHERE [Id] = @p1;
2025-07-09 15:57:26.849 +07:00 [INF] Processing job for RequestId: 382e51d8-f36d-49dd-a97b-f75f40900d09
2025-07-09 15:57:26.850 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-09 15:57:26.852 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-09 15:57:26.857 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:e884cd58-70da-4d68-b7d3-12b8aa162900
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:e884cd58-70da-4d68-b7d3-12b8aa162900
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:57:26.889 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2), @p19='?' (DbType = Int32), @p16='?' (Size = 1000), @p17='?' (DbType = DateTime2), @p18='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
UPDATE [RequestLogs] SET [ErrorMessage] = @p16, [LastUpdatedAt] = @p17, [Status] = @p18
OUTPUT 1
WHERE [Id] = @p19;
2025-07-09 15:57:26.894 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:e884cd58-70da-4d68-b7d3-12b8aa162900
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:e884cd58-70da-4d68-b7d3-12b8aa162900
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-09 15:57:26.928 +07:00 [ERR] Failed to process the job '7': an exception occurred.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.InsuranceContracts' with unique index 'IX_InsuranceContracts_LoanNo'. The duplicate key value is (LN22000001).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:e884cd58-70da-4d68-b7d3-12b8aa162900
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at pviBase.Services.InsuranceService.ProcessCreateInsuranceContractsJob(String requestId, CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 147
   at InvokeStub_TaskAwaiter.GetResult(Object, Object, IntPtr*)
   at System.Reflection.MethodBaseInvoker.InvokeWithNoArgs(Object obj, BindingFlags invokeAttr)
2025-07-09 15:57:56.306 +07:00 [DBG] Server digi-tbhh2:1208:2695a079 heartbeat successfully sent
