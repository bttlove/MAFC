2025-07-08 15:29:30.331 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 15:29:30.378 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-08 15:29:30.396 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-08 15:29:30.443 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-08 15:29:30.451 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 15:29:30.453 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-08 15:29:30.457 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-08 15:29:30.462 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-08 15:29:30.466 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-08 15:29:30.813 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-08 15:29:31.031 +07:00 [INF] Hangfire SQL objects installed.
2025-07-08 15:29:31.519 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-08 15:29:31.520 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-08 15:29:31.600 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-08 15:29:31.601 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-08 15:29:31.601 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-08 15:29:31.617 +07:00 [DBG] Execution loop BackgroundServerProcess:f12cc818 has started in 6.0518 ms
2025-07-08 15:29:31.627 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-08 15:29:31.628 +07:00 [INF] Hosting environment: Development
2025-07-08 15:29:31.629 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-08 15:29:31.636 +07:00 [INF] Server digi-tbhh2:17540:6828c257 successfully announced in 10.2382 ms
2025-07-08 15:29:31.642 +07:00 [DBG] Execution loop ServerHeartbeatProcess:7a8a3306 has started in 4.6735 ms
2025-07-08 15:29:31.642 +07:00 [INF] Server digi-tbhh2:17540:6828c257 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-08 15:29:31.650 +07:00 [DBG] Execution loop ServerWatchdog:415c8ce8 has started in 6.003 ms
2025-07-08 15:29:31.652 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:e18a5e56 has started in 7.5529 ms
2025-07-08 15:29:31.655 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:a47a25c6 has started in 5.0513 ms
2025-07-08 15:29:31.660 +07:00 [DBG] Execution loop ExpirationManager:cec243f7 has started in 7.0536 ms
2025-07-08 15:29:31.662 +07:00 [DBG] Execution loop CountersAggregator:64f685c1 has started in 6.0774 ms
2025-07-08 15:29:31.665 +07:00 [DBG] Execution loop Worker:274a9fad has started in 6.0941 ms
2025-07-08 15:29:31.668 +07:00 [DBG] Execution loop Worker:70afa864 has started in 9.4324 ms
2025-07-08 15:29:31.681 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-08 15:29:31.678 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-08 15:29:31.671 +07:00 [DBG] Execution loop Worker:a5ce7f99 has started in 12.3731 ms
2025-07-08 15:29:31.674 +07:00 [DBG] Execution loop Worker:bbbd3e32 has started in 15.248 ms
2025-07-08 15:29:31.676 +07:00 [DBG] Execution loop Worker:530712a7 has started in 17.97 ms
2025-07-08 15:29:31.680 +07:00 [DBG] Execution loop Worker:b5e75cb7 has started in 20.9924 ms
2025-07-08 15:29:31.684 +07:00 [DBG] Execution loop Worker:122414ce has started in 25.3176 ms
2025-07-08 15:29:31.686 +07:00 [DBG] Execution loop Worker:fd536089 has started in 27.1017 ms
2025-07-08 15:29:31.688 +07:00 [DBG] Execution loop Worker:22d94843 has started in 29.7446 ms
2025-07-08 15:29:31.691 +07:00 [DBG] Execution loop Worker:11ffdec8 has started in 32.9197 ms
2025-07-08 15:29:31.694 +07:00 [DBG] Execution loop Worker:302febdb has started in 35.6992 ms
2025-07-08 15:29:31.699 +07:00 [DBG] Execution loop Worker:e5aa3e7c has started in 40.4162 ms
2025-07-08 15:29:31.712 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-08 15:29:31.727 +07:00 [INF] Server digi-tbhh2:17540:6828c257 all the dispatchers started
2025-07-08 15:29:31.702 +07:00 [DBG] Execution loop Worker:78232f74 has started in 43.5054 ms
2025-07-08 15:29:31.705 +07:00 [DBG] Execution loop Worker:bdaca6f0 has started in 46.3838 ms
2025-07-08 15:29:31.708 +07:00 [DBG] Execution loop Worker:a5884029 has started in 49.3461 ms
2025-07-08 15:29:31.711 +07:00 [DBG] Execution loop Worker:3be878e2 has started in 52.5084 ms
2025-07-08 15:29:31.714 +07:00 [DBG] Execution loop Worker:07554f15 has started in 55.9782 ms
2025-07-08 15:29:31.718 +07:00 [DBG] Execution loop Worker:9246c1c1 has started in 59.0972 ms
2025-07-08 15:29:31.721 +07:00 [DBG] Execution loop Worker:05e61b73 has started in 62.1316 ms
2025-07-08 15:29:31.739 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-08 15:29:31.724 +07:00 [DBG] Execution loop Worker:3fd4d850 has started in 65.1983 ms
2025-07-08 15:29:31.727 +07:00 [DBG] Execution loop DelayedJobScheduler:6ac7aa72 has started in 6.619 ms
2025-07-08 15:29:31.731 +07:00 [DBG] Execution loop RecurringJobScheduler:3a864fd8 has started in 6.6175 ms
2025-07-08 15:29:31.742 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-08 15:29:31.754 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-08 15:29:32.028 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger - null null
2025-07-08 15:29:32.179 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger - 301 0 null 159.0085ms
2025-07-08 15:29:32.183 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/index.html - null null
2025-07-08 15:29:32.244 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/index.html - 200 null text/html;charset=utf-8 60.8414ms
2025-07-08 15:29:32.255 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/swagger-ui.css - null null
2025-07-08 15:29:32.255 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/swagger-ui-bundle.js - null null
2025-07-08 15:29:32.257 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/index.js - null null
2025-07-08 15:29:32.255 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/swagger-ui-standalone-preset.js - null null
2025-07-08 15:29:32.275 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/index.js - 200 null application/javascript;charset=utf-8 18.4011ms
2025-07-08 15:29:32.257 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-08 15:29:32.256 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/index.css - null null
2025-07-08 15:29:32.266 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-08 15:29:32.302 +07:00 [INF] Sending file. Request path: '/index.css'. Physical path: 'N/A'
2025-07-08 15:29:32.305 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/index.css - 200 202 text/css 49.8072ms
2025-07-08 15:29:32.307 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 50.0153ms
2025-07-08 15:29:32.316 +07:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2025-07-08 15:29:32.316 +07:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2025-07-08 15:29:32.334 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/swagger-ui.css - 200 154949 text/css 77.978ms
2025-07-08 15:29:32.334 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/swagger-ui-standalone-preset.js - 200 229223 text/javascript 77.8621ms
2025-07-08 15:29:32.345 +07:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2025-07-08 15:29:32.349 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/swagger-ui-bundle.js - 200 1485241 text/javascript 93.373ms
2025-07-08 15:29:32.368 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 103.7132ms
2025-07-08 15:29:32.467 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-08 15:29:32.480 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 13.6036ms
2025-07-08 15:29:32.483 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/favicon-32x32.png - null null
2025-07-08 15:29:32.486 +07:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2025-07-08 15:29:32.487 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/favicon-32x32.png - 200 628 image/png 3.9447ms
2025-07-08 15:30:01.678 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:30:31.685 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:31:01.689 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:31:31.702 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:31:42.822 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 640
2025-07-08 15:31:42.846 +07:00 [INF] CORS policy execution failed.
2025-07-08 15:31:42.848 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 15:31:42.850 +07:00 [INF] Request from IP: ::1
2025-07-08 15:31:42.854 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 15:31:42.876 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 15:31:43.062 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-08 15:31:43.085 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 202.7251ms
2025-07-08 15:31:43.086 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 15:31:43.088 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 400 248 application/problem+json; charset=utf-8 266.3673ms
2025-07-08 15:32:01.717 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:32:31.731 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:32:51.834 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/.well-known/appspecific/com.chrome.devtools.json - null null
2025-07-08 15:32:51.841 +07:00 [INF] Request from IP: ::1
2025-07-08 15:32:51.842 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/.well-known/appspecific/com.chrome.devtools.json - 404 null null 8.3542ms
2025-07-08 15:32:51.851 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET https://localhost:7024/.well-known/appspecific/com.chrome.devtools.json, Response status code: 404
2025-07-08 15:33:01.749 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:33:05.256 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - null null
2025-07-08 15:33:05.268 +07:00 [INF] Request from IP: ::1
2025-07-08 15:33:05.269 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.GetContract (pviBase)'
2025-07-08 15:33:05.274 +07:00 [INF] Route matched with {action = "GetContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContract(System.String) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 15:33:05.282 +07:00 [INF] Attempting to retrieve contract with LoanNo: MAFC_SKNVV_CreateContract
2025-07-08 15:33:05.407 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.GetContract (pviBase) in 130.6469ms
2025-07-08 15:33:05.409 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.GetContract (pviBase)'
2025-07-08 15:33:05.473 +07:00 [ERR] An unhandled exception has occurred.
System.ArgumentNullException: Value cannot be null. (Parameter 'configuration')
   at StackExchange.Redis.ConfigurationOptions.DoParse(String configuration, Boolean ignoreUnknown) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 870
   at StackExchange.Redis.ConfigurationOptions.Parse(String configuration, Boolean ignoreUnknown) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 676
   at StackExchange.Redis.ConfigurationOptions.Parse(String configuration) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 666
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCacheOptions.GetConfiguredOptions()
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.ConnectSlowAsync(CancellationToken token)
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.GetAndRefreshAsync(String key, Boolean getData, CancellationToken token)
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.GetAsync(String key, CancellationToken token)
   at Microsoft.Extensions.Caching.Distributed.DistributedCacheExtensions.GetStringAsync(IDistributedCache cache, String key, CancellationToken token)
   at pviBase.Services.InsuranceService.GetContractByLoanNo(String loanNo) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 77
   at pviBase.Controllers.HubContractController.GetContract(String loanNo) in C:\Users\ADMIN\source\repos\pviBase\Controllers\HubContractController.cs:line 75
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 29
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 26
2025-07-08 15:33:05.568 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 15:33:05.610 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
Object name: 'MemoryStream'.
   at System.IO.Stream.ValidateCopyToArguments(Stream destination, Int32 bufferSize)
   at System.IO.MemoryStream.CopyToAsync(Stream destination, Int32 bufferSize, CancellationToken cancellationToken)
   at System.IO.Stream.CopyToAsync(Stream destination)
   at Microsoft.Extensions.RazorViews.BaseView.ExecuteAsync(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 15:33:05.614 +07:00 [ERR] Connection id "0HNDTV67V3FOQ", Request id "0HNDTV67V3FOQ:0000001B": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-08 15:33:05.628 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 372.1481ms
2025-07-08 15:33:31.761 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:33:39.011 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/index.html - null null
2025-07-08 15:33:39.017 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/index.html - 200 null text/html;charset=utf-8 6.7222ms
2025-07-08 15:33:39.049 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/swagger-ui.css - null null
2025-07-08 15:33:39.052 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/index.css - null null
2025-07-08 15:33:39.052 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/.well-known/appspecific/com.chrome.devtools.json - null null
2025-07-08 15:33:39.062 +07:00 [INF] Sending file. Request path: '/index.css'. Physical path: 'N/A'
2025-07-08 15:33:39.067 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/index.js - null null
2025-07-08 15:33:39.071 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/index.css - 200 202 text/css 19.2052ms
2025-07-08 15:33:39.080 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/index.js - 200 null application/javascript;charset=utf-8 12.9492ms
2025-07-08 15:33:39.062 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/swagger-ui-standalone-preset.js - null null
2025-07-08 15:33:39.068 +07:00 [INF] Request from IP: ::1
2025-07-08 15:33:39.062 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/swagger-ui-bundle.js - null null
2025-07-08 15:33:39.102 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/.well-known/appspecific/com.chrome.devtools.json - 404 null null 49.6437ms
2025-07-08 15:33:39.070 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-08 15:33:39.112 +07:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET https://localhost:7024/.well-known/appspecific/com.chrome.devtools.json, Response status code: 404
2025-07-08 15:33:39.118 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 48.6132ms
2025-07-08 15:33:39.077 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-08 15:33:39.105 +07:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2025-07-08 15:33:39.100 +07:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2025-07-08 15:33:39.137 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/swagger-ui-standalone-preset.js - 200 229223 text/javascript 75.6511ms
2025-07-08 15:33:39.140 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/swagger-ui.css - 200 154949 text/css 91.2313ms
2025-07-08 15:33:39.143 +07:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2025-07-08 15:33:39.149 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 73.0225ms
2025-07-08 15:33:39.152 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/swagger-ui-bundle.js - 200 1485241 text/javascript 90.427ms
2025-07-08 15:33:39.267 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/favicon-32x32.png - null null
2025-07-08 15:33:39.267 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-08 15:33:39.270 +07:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2025-07-08 15:33:39.272 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/favicon-32x32.png - 200 628 image/png 5.3417ms
2025-07-08 15:33:39.281 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 13.9952ms
2025-07-08 15:34:01.771 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:34:17.367 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 647
2025-07-08 15:34:17.375 +07:00 [INF] CORS policy execution failed.
2025-07-08 15:34:17.376 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 15:34:17.377 +07:00 [INF] Request from IP: ::1
2025-07-08 15:34:17.378 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 15:34:17.379 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 15:34:17.385 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-08 15:34:17.386 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 5.0688ms
2025-07-08 15:34:17.386 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 15:34:17.387 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 400 248 application/problem+json; charset=utf-8 20.8396ms
2025-07-08 15:34:19.442 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 647
2025-07-08 15:34:19.445 +07:00 [INF] CORS policy execution failed.
2025-07-08 15:34:19.446 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 15:34:19.447 +07:00 [INF] Request from IP: ::1
2025-07-08 15:34:19.447 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 15:34:19.448 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 15:34:19.453 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-08 15:34:19.454 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 3.9691ms
2025-07-08 15:34:19.455 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 15:34:19.456 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 400 248 application/problem+json; charset=utf-8 13.5158ms
2025-07-08 15:34:31.724 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-08 15:34:31.787 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:35:01.806 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:35:31.809 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:36:01.823 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:36:31.832 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:37:01.848 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:37:26.338 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 646
2025-07-08 15:37:26.344 +07:00 [INF] CORS policy execution failed.
2025-07-08 15:37:26.345 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 15:37:26.346 +07:00 [INF] Request from IP: ::1
2025-07-08 15:37:26.347 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 15:37:26.348 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 15:37:26.350 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-08 15:37:26.351 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 2.1765ms
2025-07-08 15:37:26.352 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 15:37:26.353 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 400 248 application/problem+json; charset=utf-8 15.2578ms
2025-07-08 15:37:31.864 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:38:00.809 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 572
2025-07-08 15:38:00.822 +07:00 [INF] CORS policy execution failed.
2025-07-08 15:38:00.823 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 15:38:00.824 +07:00 [INF] Request from IP: ::1
2025-07-08 15:38:00.825 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 15:38:00.826 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 15:38:00.832 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-08 15:38:00.835 +07:00 [INF] Executing UnauthorizedObjectResult, writing value of type 'pviBase.Dtos.ApiResponse'.
2025-07-08 15:38:00.838 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 10.0627ms
2025-07-08 15:38:00.839 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 15:38:00.841 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 401 61 application/json; charset=utf-8 32.5375ms
2025-07-08 15:38:01.875 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:38:31.882 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:39:01.899 +07:00 [DBG] Server digi-tbhh2:17540:6828c257 heartbeat successfully sent
2025-07-08 15:39:20.331 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 15:39:20.389 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-08 15:39:20.402 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-08 15:39:20.452 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-08 15:39:20.459 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 15:39:20.461 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-08 15:39:20.466 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-08 15:39:20.473 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-08 15:39:20.475 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-08 15:39:20.734 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-08 15:39:20.827 +07:00 [INF] Hangfire SQL objects installed.
2025-07-08 15:39:21.131 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-08 15:39:21.132 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-08 15:39:21.201 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-08 15:39:21.202 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-08 15:39:21.203 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-08 15:39:21.216 +07:00 [DBG] Execution loop BackgroundServerProcess:bdeced34 has started in 6.3784 ms
2025-07-08 15:39:21.222 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-08 15:39:21.223 +07:00 [INF] Hosting environment: Development
2025-07-08 15:39:21.224 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-08 15:39:21.232 +07:00 [INF] Server digi-tbhh2:14764:edb6e474 successfully announced in 9.4034 ms
2025-07-08 15:39:21.238 +07:00 [DBG] Execution loop ServerHeartbeatProcess:f8434973 has started in 4.472 ms
2025-07-08 15:39:21.238 +07:00 [INF] Server digi-tbhh2:14764:edb6e474 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-08 15:39:21.243 +07:00 [DBG] Execution loop ServerWatchdog:986d63ad has started in 4.4632 ms
2025-07-08 15:39:21.247 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:b8797c69 has started in 7.496 ms
2025-07-08 15:39:21.250 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:08990fa2 has started in 6.9011 ms
2025-07-08 15:39:21.253 +07:00 [DBG] Execution loop ExpirationManager:5b8b64d1 has started in 6.266 ms
2025-07-08 15:39:21.256 +07:00 [DBG] Execution loop CountersAggregator:7d1fc543 has started in 6.056 ms
2025-07-08 15:39:21.259 +07:00 [DBG] Execution loop Worker:67c3b680 has started in 6.2535 ms
2025-07-08 15:39:21.274 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-08 15:39:21.280 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-08 15:39:21.262 +07:00 [DBG] Execution loop Worker:aeca4ddb has started in 9.3068 ms
2025-07-08 15:39:21.266 +07:00 [DBG] Execution loop Worker:a930b609 has started in 12.821 ms
2025-07-08 15:39:21.293 +07:00 [DBG] Execution loop Worker:d8c42fd0 has started in 39.8638 ms
2025-07-08 15:39:21.271 +07:00 [DBG] Execution loop Worker:ab0c1396 has started in 18.1909 ms
2025-07-08 15:39:21.273 +07:00 [DBG] Execution loop Worker:104c5f71 has started in 19.9765 ms
2025-07-08 15:39:21.276 +07:00 [DBG] Execution loop Worker:671035c3 has started in 22.7693 ms
2025-07-08 15:39:21.279 +07:00 [DBG] Execution loop Worker:123a85b6 has started in 25.4277 ms
2025-07-08 15:39:21.282 +07:00 [DBG] Execution loop Worker:7ec9fb4b has started in 28.383 ms
2025-07-08 15:39:21.313 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-08 15:39:21.284 +07:00 [DBG] Execution loop Worker:87cabea5 has started in 31.1595 ms
2025-07-08 15:39:21.322 +07:00 [INF] Server digi-tbhh2:14764:edb6e474 all the dispatchers started
2025-07-08 15:39:21.287 +07:00 [DBG] Execution loop Worker:150041f4 has started in 33.8769 ms
2025-07-08 15:39:21.290 +07:00 [DBG] Execution loop Worker:fbfa6e44 has started in 36.7843 ms
2025-07-08 15:39:21.297 +07:00 [DBG] Execution loop Worker:b44bd9c7 has started in 43.1656 ms
2025-07-08 15:39:21.300 +07:00 [DBG] Execution loop Worker:03d98806 has started in 46.531 ms
2025-07-08 15:39:21.303 +07:00 [DBG] Execution loop Worker:13904950 has started in 49.6754 ms
2025-07-08 15:39:21.306 +07:00 [DBG] Execution loop Worker:c7df421a has started in 52.8149 ms
2025-07-08 15:39:21.310 +07:00 [DBG] Execution loop Worker:11638eec has started in 56.8136 ms
2025-07-08 15:39:21.333 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-08 15:39:21.312 +07:00 [DBG] Execution loop Worker:c50765eb has started in 58.9146 ms
2025-07-08 15:39:21.315 +07:00 [DBG] Execution loop Worker:52de0849 has started in 62.1741 ms
2025-07-08 15:39:21.319 +07:00 [DBG] Execution loop Worker:e888531e has started in 65.3919 ms
2025-07-08 15:39:21.322 +07:00 [DBG] Execution loop DelayedJobScheduler:eb1230f7 has started in 6.2835 ms
2025-07-08 15:39:21.324 +07:00 [DBG] Execution loop RecurringJobScheduler:c9e89069 has started in 5.971 ms
2025-07-08 15:39:21.336 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-08 15:39:21.340 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-08 15:39:22.062 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-08 15:39:22.062 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-08 15:39:22.100 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 41.8394ms
2025-07-08 15:39:22.141 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 84.0217ms
2025-07-08 15:39:22.169 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-08 15:39:22.197 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 28.1018ms
2025-07-08 15:39:44.007 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 572
2025-07-08 15:39:44.023 +07:00 [INF] CORS policy execution failed.
2025-07-08 15:39:44.024 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 15:39:44.027 +07:00 [INF] Request from IP: ::1
2025-07-08 15:39:44.029 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 15:39:44.048 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 15:39:44.191 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-08 15:39:44.353 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 301.6759ms
2025-07-08 15:39:44.355 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 15:39:44.401 +07:00 [ERR] An unhandled exception has occurred.
System.ArgumentNullException: Value cannot be null. (Parameter 'configuration')
   at StackExchange.Redis.ConfigurationOptions.DoParse(String configuration, Boolean ignoreUnknown) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 870
   at StackExchange.Redis.ConfigurationOptions.Parse(String configuration, Boolean ignoreUnknown) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 676
   at StackExchange.Redis.ConfigurationOptions.Parse(String configuration) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 666
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCacheOptions.GetConfiguredOptions()
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.ConnectSlowAsync(CancellationToken token)
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.RemoveAsync(String key, CancellationToken token)
   at pviBase.Services.InsuranceService.CreateInsuranceContracts(List`1 contractDtos) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 66
   at pviBase.Controllers.HubContractController.CreateContract(CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Controllers\HubContractController.cs:line 54
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 29
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 26
2025-07-08 15:39:44.481 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 15:39:44.487 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 15:39:44.492 +07:00 [ERR] Connection id "0HNDTVBNOVVL8", Request id "0HNDTVBNOVVL8:00000007": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-08 15:39:44.502 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 494.9587ms
2025-07-08 15:39:51.263 +07:00 [DBG] Server digi-tbhh2:14764:edb6e474 heartbeat successfully sent
2025-07-08 15:40:21.271 +07:00 [DBG] Server digi-tbhh2:14764:edb6e474 heartbeat successfully sent
2025-07-08 15:40:51.278 +07:00 [DBG] Server digi-tbhh2:14764:edb6e474 heartbeat successfully sent
2025-07-08 15:41:21.287 +07:00 [DBG] Server digi-tbhh2:14764:edb6e474 heartbeat successfully sent
2025-07-08 15:41:51.292 +07:00 [DBG] Server digi-tbhh2:14764:edb6e474 heartbeat successfully sent
2025-07-08 15:42:21.300 +07:00 [DBG] Server digi-tbhh2:14764:edb6e474 heartbeat successfully sent
2025-07-08 16:28:20.873 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 16:28:20.910 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-08 16:28:20.932 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-08 16:28:20.983 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-08 16:28:20.989 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 16:28:20.992 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-08 16:28:20.997 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-08 16:28:21.004 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-08 16:28:21.007 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-08 16:28:21.273 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-08 16:28:21.392 +07:00 [INF] Hangfire SQL objects installed.
2025-07-08 16:28:21.796 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-08 16:28:21.797 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-08 16:28:21.869 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-08 16:28:21.870 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-08 16:28:21.871 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-08 16:28:21.883 +07:00 [DBG] Execution loop BackgroundServerProcess:3ee46041 has started in 5.7608 ms
2025-07-08 16:28:21.889 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-08 16:28:21.890 +07:00 [INF] Hosting environment: Development
2025-07-08 16:28:21.890 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-08 16:28:21.897 +07:00 [INF] Server digi-tbhh2:31040:b7a0cbf2 successfully announced in 7.9944 ms
2025-07-08 16:28:21.902 +07:00 [INF] Server digi-tbhh2:31040:b7a0cbf2 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-08 16:28:21.902 +07:00 [DBG] Execution loop ServerHeartbeatProcess:fed8b55d has started in 4.2628 ms
2025-07-08 16:28:21.906 +07:00 [DBG] Execution loop ServerWatchdog:01fb5ed8 has started in 2.8293 ms
2025-07-08 16:28:21.908 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:85a8c46c has started in 5.0305 ms
2025-07-08 16:28:21.911 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:ee1b6a45 has started in 5.2404 ms
2025-07-08 16:28:21.914 +07:00 [DBG] Execution loop ExpirationManager:6b879628 has started in 5.0724 ms
2025-07-08 16:28:21.917 +07:00 [DBG] Execution loop CountersAggregator:20cfadfd has started in 5.2333 ms
2025-07-08 16:28:21.920 +07:00 [DBG] Execution loop Worker:a2c5d75c has started in 6.8521 ms
2025-07-08 16:28:21.925 +07:00 [DBG] Execution loop Worker:a6fc787c has started in 11.2743 ms
2025-07-08 16:28:21.925 +07:00 [INF] 2 servers were removed due to timeout
2025-07-08 16:28:21.930 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-08 16:28:21.926 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-08 16:28:21.929 +07:00 [DBG] Execution loop Worker:d85d9431 has started in 14.948 ms
2025-07-08 16:28:21.932 +07:00 [DBG] Execution loop Worker:98499706 has started in 18.3236 ms
2025-07-08 16:28:21.935 +07:00 [DBG] Execution loop Worker:f6e43cb7 has started in 21.6687 ms
2025-07-08 16:28:21.938 +07:00 [DBG] Execution loop Worker:b33078ad has started in 24.5894 ms
2025-07-08 16:28:21.941 +07:00 [DBG] Execution loop Worker:b8f51321 has started in 27.3898 ms
2025-07-08 16:28:22.029 +07:00 [DBG] Execution loop Worker:0854da28 has started in 114.9816 ms
2025-07-08 16:28:22.030 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-08 16:28:21.944 +07:00 [DBG] Execution loop Worker:dd520e4c has started in 30.485 ms
2025-07-08 16:28:21.949 +07:00 [DBG] Execution loop Worker:acd1b673 has started in 35.063 ms
2025-07-08 16:28:21.952 +07:00 [DBG] Execution loop Worker:5451e7f0 has started in 38.4464 ms
2025-07-08 16:28:21.955 +07:00 [DBG] Execution loop Worker:dce6517c has started in 41.4659 ms
2025-07-08 16:28:22.058 +07:00 [INF] Server digi-tbhh2:31040:b7a0cbf2 all the dispatchers started
2025-07-08 16:28:22.059 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-08 16:28:21.958 +07:00 [DBG] Execution loop Worker:04ccf9a1 has started in 44.6441 ms
2025-07-08 16:28:22.023 +07:00 [DBG] Execution loop Worker:1bcd5ffc has started in 109.2963 ms
2025-07-08 16:28:22.023 +07:00 [DBG] Execution loop Worker:07b791cc has started in 109.2805 ms
2025-07-08 16:28:22.069 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-08 16:28:22.023 +07:00 [DBG] Execution loop Worker:4fd6df61 has started in 109.2781 ms
2025-07-08 16:28:22.034 +07:00 [DBG] Execution loop Worker:1485ddf2 has started in 120.3248 ms
2025-07-08 16:28:22.042 +07:00 [DBG] Execution loop Worker:6fb14d86 has started in 128.4889 ms
2025-07-08 16:28:22.074 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-08 16:28:22.048 +07:00 [DBG] Execution loop Worker:b8d22c55 has started in 133.5799 ms
2025-07-08 16:28:22.053 +07:00 [DBG] Execution loop Worker:d7881dd1 has started in 139.2972 ms
2025-07-08 16:28:22.058 +07:00 [DBG] Execution loop DelayedJobScheduler:b4a8cd02 has started in 10.4615 ms
2025-07-08 16:28:22.061 +07:00 [DBG] Execution loop RecurringJobScheduler:7bf570f0 has started in 7.9114 ms
2025-07-08 16:28:22.574 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-08 16:28:22.574 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-08 16:28:22.610 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 42.3155ms
2025-07-08 16:28:22.686 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 119.1456ms
2025-07-08 16:28:22.714 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-08 16:28:22.743 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 28.6894ms
2025-07-08 16:28:51.929 +07:00 [DBG] Server digi-tbhh2:31040:b7a0cbf2 heartbeat successfully sent
2025-07-08 16:29:21.935 +07:00 [DBG] Server digi-tbhh2:31040:b7a0cbf2 heartbeat successfully sent
2025-07-08 16:29:50.845 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 572
2025-07-08 16:29:50.873 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:29:50.874 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:29:50.877 +07:00 [INF] Request from IP: ::1
2025-07-08 16:29:50.880 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:29:50.903 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:29:51.075 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-08 16:29:51.253 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 345.9867ms
2025-07-08 16:29:51.255 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:29:51.302 +07:00 [ERR] An unhandled exception has occurred.
System.ArgumentNullException: Value cannot be null. (Parameter 'configuration')
   at StackExchange.Redis.ConfigurationOptions.DoParse(String configuration, Boolean ignoreUnknown) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 870
   at StackExchange.Redis.ConfigurationOptions.Parse(String configuration, Boolean ignoreUnknown) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 676
   at StackExchange.Redis.ConfigurationOptions.Parse(String configuration) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 666
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCacheOptions.GetConfiguredOptions()
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.ConnectSlowAsync(CancellationToken token)
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.RemoveAsync(String key, CancellationToken token)
   at pviBase.Services.InsuranceService.CreateInsuranceContracts(List`1 contractDtos) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 66
   at pviBase.Controllers.HubContractController.CreateContract(CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Controllers\HubContractController.cs:line 54
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 29
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 26
2025-07-08 16:29:51.391 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:29:51.401 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:29:51.407 +07:00 [ERR] Connection id "0HNDU0744CDUN", Request id "0HNDU0744CDUN:00000007": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-08 16:29:51.429 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 583.3637ms
2025-07-08 16:29:51.942 +07:00 [DBG] Server digi-tbhh2:31040:b7a0cbf2 heartbeat successfully sent
2025-07-08 16:30:10.608 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - application/json-patch+json 114
2025-07-08 16:30:10.618 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:30:10.618 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:30:10.619 +07:00 [INF] Request from IP: ::1
2025-07-08 16:30:10.620 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-08 16:30:10.624 +07:00 [INF] Route matched with {action = "GetContractByLoanNo", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContractByLoanNo(pviBase.Dtos.GetContractByLoanNoRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:30:10.640 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-08 16:30:10.659 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase) in 33.3484ms
2025-07-08 16:30:10.660 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-08 16:30:10.662 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - 400 248 application/problem+json; charset=utf-8 54.2559ms
2025-07-08 16:30:19.007 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - application/json-patch+json 113
2025-07-08 16:30:19.011 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:30:19.012 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:30:19.013 +07:00 [INF] Request from IP: ::1
2025-07-08 16:30:19.013 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-08 16:30:19.015 +07:00 [INF] Route matched with {action = "GetContractByLoanNo", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContractByLoanNo(pviBase.Dtos.GetContractByLoanNoRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:30:19.022 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-08 16:30:19.023 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase) in 6.8166ms
2025-07-08 16:30:19.024 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-08 16:30:19.025 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - 400 248 application/problem+json; charset=utf-8 18.6292ms
2025-07-08 16:30:21.951 +07:00 [DBG] Server digi-tbhh2:31040:b7a0cbf2 heartbeat successfully sent
2025-07-08 16:30:51.969 +07:00 [DBG] Server digi-tbhh2:31040:b7a0cbf2 heartbeat successfully sent
2025-07-08 16:32:57.837 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 16:32:57.871 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-08 16:32:57.882 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-08 16:32:57.927 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-08 16:32:57.935 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 16:32:57.937 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-08 16:32:57.941 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-08 16:32:57.947 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-08 16:32:57.948 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-08 16:32:58.087 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-08 16:32:58.173 +07:00 [INF] Hangfire SQL objects installed.
2025-07-08 16:32:58.439 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-08 16:32:58.440 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-08 16:32:58.509 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-08 16:32:58.510 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-08 16:32:58.511 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-08 16:32:58.523 +07:00 [DBG] Execution loop BackgroundServerProcess:ef3bd2c9 has started in 5.4018 ms
2025-07-08 16:32:58.529 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-08 16:32:58.530 +07:00 [INF] Hosting environment: Development
2025-07-08 16:32:58.531 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-08 16:32:58.539 +07:00 [INF] Server digi-tbhh2:25256:dd3ceb94 successfully announced in 9.413 ms
2025-07-08 16:32:58.543 +07:00 [DBG] Execution loop ServerHeartbeatProcess:c3c349d0 has started in 3.7935 ms
2025-07-08 16:32:58.543 +07:00 [INF] Server digi-tbhh2:25256:dd3ceb94 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-08 16:32:58.548 +07:00 [DBG] Execution loop ServerWatchdog:55508765 has started in 3.5668 ms
2025-07-08 16:32:58.551 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:dbba0dbc has started in 6.3653 ms
2025-07-08 16:32:58.556 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:264cb7fc has started in 7.7374 ms
2025-07-08 16:32:58.558 +07:00 [DBG] Execution loop ExpirationManager:eaf0e039 has started in 6.4653 ms
2025-07-08 16:32:58.561 +07:00 [DBG] Execution loop CountersAggregator:66ff3c1d has started in 5.7972 ms
2025-07-08 16:32:58.566 +07:00 [DBG] Execution loop Worker:e6d97e67 has started in 6.8235 ms
2025-07-08 16:32:58.568 +07:00 [DBG] Execution loop Worker:1fd13b1e has started in 9.5466 ms
2025-07-08 16:32:58.574 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-08 16:32:58.577 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-08 16:32:58.570 +07:00 [DBG] Execution loop Worker:140381cd has started in 12.306 ms
2025-07-08 16:32:58.573 +07:00 [DBG] Execution loop Worker:8ba313fb has started in 14.9861 ms
2025-07-08 16:32:58.576 +07:00 [DBG] Execution loop Worker:683b6619 has started in 17.5869 ms
2025-07-08 16:32:58.581 +07:00 [DBG] Execution loop Worker:f7209974 has started in 22.5094 ms
2025-07-08 16:32:58.583 +07:00 [DBG] Execution loop Worker:8c9d5854 has started in 24.5648 ms
2025-07-08 16:32:58.611 +07:00 [DBG] Execution loop Worker:20fe8d2a has started in 52.4986 ms
2025-07-08 16:32:58.599 +07:00 [DBG] Execution loop Worker:ff51e01a has started in 41.3227 ms
2025-07-08 16:32:58.588 +07:00 [DBG] Execution loop Worker:95954f89 has started in 30.1738 ms
2025-07-08 16:32:58.615 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-08 16:32:58.585 +07:00 [DBG] Execution loop Worker:df7ffa8b has started in 27.3747 ms
2025-07-08 16:32:58.627 +07:00 [INF] Server digi-tbhh2:25256:dd3ceb94 all the dispatchers started
2025-07-08 16:32:58.591 +07:00 [DBG] Execution loop Worker:344374c8 has started in 32.9439 ms
2025-07-08 16:32:58.594 +07:00 [DBG] Execution loop Worker:0a09efba has started in 36.2315 ms
2025-07-08 16:32:58.601 +07:00 [DBG] Execution loop Worker:4c2a6c0d has started in 43.2203 ms
2025-07-08 16:32:58.604 +07:00 [DBG] Execution loop Worker:23de4f62 has started in 46.118 ms
2025-07-08 16:32:58.608 +07:00 [DBG] Execution loop Worker:2ace41dc has started in 50.1244 ms
2025-07-08 16:32:58.614 +07:00 [DBG] Execution loop Worker:e6784546 has started in 55.8282 ms
2025-07-08 16:32:58.634 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-08 16:32:58.617 +07:00 [DBG] Execution loop Worker:0415331b has started in 59.158 ms
2025-07-08 16:32:58.620 +07:00 [DBG] Execution loop Worker:765dca6c has started in 62.2097 ms
2025-07-08 16:32:58.624 +07:00 [DBG] Execution loop Worker:a6c16439 has started in 66.4364 ms
2025-07-08 16:32:58.627 +07:00 [DBG] Execution loop DelayedJobScheduler:38308cde has started in 6.9468 ms
2025-07-08 16:32:58.630 +07:00 [DBG] Execution loop RecurringJobScheduler:0da3df43 has started in 7.0814 ms
2025-07-08 16:32:58.642 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-08 16:32:58.647 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-08 16:32:59.168 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-08 16:32:59.168 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-08 16:32:59.206 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 42.1887ms
2025-07-08 16:32:59.243 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 81.093ms
2025-07-08 16:32:59.273 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-08 16:32:59.307 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 33.1411ms
2025-07-08 16:33:28.561 +07:00 [DBG] Server digi-tbhh2:25256:dd3ceb94 heartbeat successfully sent
2025-07-08 16:33:28.586 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 572
2025-07-08 16:33:28.616 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:33:28.617 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:33:28.622 +07:00 [INF] Request from IP: ::1
2025-07-08 16:33:28.625 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:33:28.644 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:33:28.796 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-08 16:33:28.946 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 296.863ms
2025-07-08 16:33:28.948 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:33:28.992 +07:00 [ERR] An unhandled exception has occurred.
System.ArgumentNullException: Value cannot be null. (Parameter 'configuration')
   at StackExchange.Redis.ConfigurationOptions.DoParse(String configuration, Boolean ignoreUnknown) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 870
   at StackExchange.Redis.ConfigurationOptions.Parse(String configuration, Boolean ignoreUnknown) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 676
   at StackExchange.Redis.ConfigurationOptions.Parse(String configuration) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 666
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCacheOptions.GetConfiguredOptions()
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.ConnectSlowAsync(CancellationToken token)
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.RemoveAsync(String key, CancellationToken token)
   at pviBase.Services.InsuranceService.CreateInsuranceContracts(List`1 contractDtos) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 66
   at pviBase.Controllers.HubContractController.CreateContract(CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Controllers\HubContractController.cs:line 54
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 29
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 26
2025-07-08 16:33:29.060 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:33:29.066 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:33:29.071 +07:00 [ERR] Connection id "0HNDU09MIQVDS", Request id "0HNDU09MIQVDS:00000007": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-08 16:33:29.078 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 492.406ms
2025-07-08 16:33:58.574 +07:00 [DBG] Server digi-tbhh2:25256:dd3ceb94 heartbeat successfully sent
2025-07-08 16:34:11.985 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - application/json-patch+json 118
2025-07-08 16:34:12.043 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:34:12.044 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:34:12.046 +07:00 [INF] Request from IP: ::1
2025-07-08 16:34:12.047 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-08 16:34:12.052 +07:00 [INF] Route matched with {action = "GetContractByLoanNo", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContractByLoanNo(pviBase.Dtos.GetContractByLoanNoRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:34:12.069 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-08 16:34:12.087 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase) in 32.1633ms
2025-07-08 16:34:12.089 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-08 16:34:12.090 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - 400 248 application/problem+json; charset=utf-8 105.4145ms
2025-07-08 16:34:21.374 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - application/json-patch+json 117
2025-07-08 16:34:21.376 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:34:21.377 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:34:21.378 +07:00 [INF] Request from IP: ::1
2025-07-08 16:34:21.379 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-08 16:34:21.380 +07:00 [INF] Route matched with {action = "GetContractByLoanNo", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContractByLoanNo(pviBase.Dtos.GetContractByLoanNoRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:34:21.386 +07:00 [INF] Received request to get detailed contract for LoanNo: LN22000001
2025-07-08 16:34:21.652 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__loanNo_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [i].[Id], [i].[CreatedAt], [i].[CustAddress], [i].[CustBirthday], [i].[CustEmail], [i].[CustGender], [i].[CustIdNo], [i].[CustName], [i].[CustPhone], [i].[DisbursementDate], [i].[InsRate], [i].[LoanAmount], [i].[LoanDate], [i].[LoanNo], [i].[LoanTerm], [i].[LoanType], [i].[UpdatedAt]
FROM [InsuranceContracts] AS [i]
WHERE [i].[LoanNo] = @__loanNo_0
2025-07-08 16:34:21.661 +07:00 [WRN] Detailed contract for LoanNo LN22000001 not found.
2025-07-08 16:34:21.666 +07:00 [INF] Executing NotFoundObjectResult, writing value of type 'pviBase.Dtos.ApiResponse'.
2025-07-08 16:34:21.670 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase) in 288.7501ms
2025-07-08 16:34:21.672 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-08 16:34:21.677 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - 404 92 application/json; charset=utf-8 303.6068ms
2025-07-08 16:34:28.586 +07:00 [DBG] Server digi-tbhh2:25256:dd3ceb94 heartbeat successfully sent
2025-07-08 16:34:58.605 +07:00 [DBG] Server digi-tbhh2:25256:dd3ceb94 heartbeat successfully sent
2025-07-08 16:35:28.613 +07:00 [DBG] Server digi-tbhh2:25256:dd3ceb94 heartbeat successfully sent
2025-07-08 16:37:14.102 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 16:37:14.153 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-08 16:37:14.167 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-08 16:37:14.214 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-08 16:37:14.220 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 16:37:14.222 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-08 16:37:14.225 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-08 16:37:14.231 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-08 16:37:14.233 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-08 16:37:14.460 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-08 16:37:14.550 +07:00 [INF] Hangfire SQL objects installed.
2025-07-08 16:37:14.839 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-08 16:37:14.840 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-08 16:37:14.906 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-08 16:37:14.906 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-08 16:37:14.907 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-08 16:37:14.919 +07:00 [DBG] Execution loop BackgroundServerProcess:c609fc68 has started in 5.1826 ms
2025-07-08 16:37:14.924 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-08 16:37:14.925 +07:00 [INF] Hosting environment: Development
2025-07-08 16:37:14.926 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-08 16:37:14.933 +07:00 [INF] Server digi-tbhh2:29604:4144d765 successfully announced in 8.433 ms
2025-07-08 16:37:14.937 +07:00 [DBG] Execution loop ServerHeartbeatProcess:d4823fef has started in 2.8133 ms
2025-07-08 16:37:14.937 +07:00 [INF] Server digi-tbhh2:29604:4144d765 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-08 16:37:14.940 +07:00 [DBG] Execution loop ServerWatchdog:6b8cb8c1 has started in 2.3015 ms
2025-07-08 16:37:14.943 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:858f74ac has started in 4.3267 ms
2025-07-08 16:37:14.946 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:fa65f2d6 has started in 5.34 ms
2025-07-08 16:37:14.947 +07:00 [DBG] Execution loop ExpirationManager:d1673df3 has started in 4.59 ms
2025-07-08 16:37:14.949 +07:00 [DBG] Execution loop CountersAggregator:a5ca2ab2 has started in 4.6706 ms
2025-07-08 16:37:14.956 +07:00 [INF] 1 servers were removed due to timeout
2025-07-08 16:37:14.962 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-08 16:37:14.952 +07:00 [DBG] Execution loop Worker:b6e8e1af has started in 4.8446 ms
2025-07-08 16:37:14.967 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-08 16:37:14.954 +07:00 [DBG] Execution loop Worker:827f154d has started in 6.9496 ms
2025-07-08 16:37:14.956 +07:00 [DBG] Execution loop Worker:bafc1891 has started in 9.2592 ms
2025-07-08 16:37:14.959 +07:00 [DBG] Execution loop Worker:abdb8418 has started in 11.4483 ms
2025-07-08 16:37:14.961 +07:00 [DBG] Execution loop Worker:c16f50b1 has started in 13.5641 ms
2025-07-08 16:37:14.963 +07:00 [DBG] Execution loop Worker:7b1de8e8 has started in 16.2874 ms
2025-07-08 16:37:14.966 +07:00 [DBG] Execution loop Worker:e135fe0b has started in 18.7733 ms
2025-07-08 16:37:14.968 +07:00 [DBG] Execution loop Worker:083a1a50 has started in 21.1466 ms
2025-07-08 16:37:14.995 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-08 16:37:14.971 +07:00 [DBG] Execution loop Worker:331ccfe7 has started in 23.4751 ms
2025-07-08 16:37:15.005 +07:00 [DBG] Execution loop RecurringJobScheduler:db20902f has started in 5.301 ms
2025-07-08 16:37:14.973 +07:00 [DBG] Execution loop Worker:ae3d1e37 has started in 25.8576 ms
2025-07-08 16:37:14.975 +07:00 [DBG] Execution loop Worker:7078c330 has started in 28.2394 ms
2025-07-08 16:37:14.978 +07:00 [DBG] Execution loop Worker:6954f35f has started in 31.2627 ms
2025-07-08 16:37:14.982 +07:00 [DBG] Execution loop Worker:4fc74610 has started in 34.7696 ms
2025-07-08 16:37:14.984 +07:00 [DBG] Execution loop Worker:4b8be5b1 has started in 36.4691 ms
2025-07-08 16:37:14.986 +07:00 [DBG] Execution loop Worker:32f0f5b0 has started in 39.0783 ms
2025-07-08 16:37:14.989 +07:00 [DBG] Execution loop Worker:d2314ddb has started in 41.5 ms
2025-07-08 16:37:14.991 +07:00 [DBG] Execution loop Worker:c2d1d1ae has started in 44.2758 ms
2025-07-08 16:37:14.994 +07:00 [DBG] Execution loop Worker:2464863d has started in 47.1247 ms
2025-07-08 16:37:14.997 +07:00 [DBG] Execution loop Worker:aa0ea22f has started in 49.666 ms
2025-07-08 16:37:15.002 +07:00 [INF] Server digi-tbhh2:29604:4144d765 all the dispatchers started
2025-07-08 16:37:15.013 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-08 16:37:14.999 +07:00 [DBG] Execution loop Worker:704e9af4 has started in 52.2569 ms
2025-07-08 16:37:15.002 +07:00 [DBG] Execution loop DelayedJobScheduler:e158c16c has started in 5.2242 ms
2025-07-08 16:37:15.018 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-08 16:37:15.020 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-08 16:37:15.636 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-08 16:37:15.636 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-08 16:37:15.675 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 44.9188ms
2025-07-08 16:37:15.709 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 79.9001ms
2025-07-08 16:37:15.734 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-08 16:37:15.762 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 27.8415ms
2025-07-08 16:37:28.539 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 571
2025-07-08 16:37:28.559 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:37:28.560 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:37:28.562 +07:00 [INF] Request from IP: ::1
2025-07-08 16:37:28.566 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:37:28.582 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:37:28.753 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-08 16:37:28.912 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 323.0009ms
2025-07-08 16:37:28.914 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:37:28.969 +07:00 [ERR] An unhandled exception has occurred.
System.ArgumentNullException: Value cannot be null. (Parameter 'configuration')
   at StackExchange.Redis.ConfigurationOptions.DoParse(String configuration, Boolean ignoreUnknown) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 870
   at StackExchange.Redis.ConfigurationOptions.Parse(String configuration, Boolean ignoreUnknown) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 676
   at StackExchange.Redis.ConfigurationOptions.Parse(String configuration) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 666
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCacheOptions.GetConfiguredOptions()
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.ConnectSlowAsync(CancellationToken token)
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.RemoveAsync(String key, CancellationToken token)
   at pviBase.Services.InsuranceService.CreateInsuranceContracts(List`1 contractDtos) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 66
   at pviBase.Controllers.HubContractController.CreateContract(CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Controllers\HubContractController.cs:line 54
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 29
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 26
2025-07-08 16:37:29.044 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:37:29.052 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:37:29.059 +07:00 [ERR] Connection id "0HNDU0C312UF3", Request id "0HNDU0C312UF3:00000007": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-08 16:37:29.068 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 529.4143ms
2025-07-08 16:37:44.972 +07:00 [DBG] Server digi-tbhh2:29604:4144d765 heartbeat successfully sent
2025-07-08 16:38:14.648 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 572
2025-07-08 16:38:14.664 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:38:14.665 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:38:14.666 +07:00 [INF] Request from IP: ::1
2025-07-08 16:38:14.667 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:38:14.668 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:38:14.685 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-08 16:38:14.701 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 31.4339ms
2025-07-08 16:38:14.704 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:38:14.705 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 400 248 application/problem+json; charset=utf-8 57.6623ms
2025-07-08 16:38:14.979 +07:00 [DBG] Server digi-tbhh2:29604:4144d765 heartbeat successfully sent
2025-07-08 16:38:21.656 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 571
2025-07-08 16:38:21.658 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:38:21.659 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:38:21.660 +07:00 [INF] Request from IP: ::1
2025-07-08 16:38:21.661 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:38:21.662 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:38:21.668 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-08 16:38:21.741 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 77.1786ms
2025-07-08 16:38:21.742 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:38:21.780 +07:00 [ERR] An unhandled exception has occurred.
System.ArgumentNullException: Value cannot be null. (Parameter 'configuration')
   at StackExchange.Redis.ConfigurationOptions.DoParse(String configuration, Boolean ignoreUnknown) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 870
   at StackExchange.Redis.ConfigurationOptions.Parse(String configuration, Boolean ignoreUnknown) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 676
   at StackExchange.Redis.ConfigurationOptions.Parse(String configuration) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 666
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCacheOptions.GetConfiguredOptions()
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.ConnectSlowAsync(CancellationToken token)
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.RemoveAsync(String key, CancellationToken token)
   at pviBase.Services.InsuranceService.CreateInsuranceContracts(List`1 contractDtos) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 66
   at pviBase.Controllers.HubContractController.CreateContract(CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Controllers\HubContractController.cs:line 54
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 29
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 26
2025-07-08 16:38:21.808 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:38:21.811 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:38:21.813 +07:00 [ERR] Connection id "0HNDU0C312UF3", Request id "0HNDU0C312UF3:0000000B": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-08 16:38:21.818 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 163.4463ms
2025-07-08 16:38:44.992 +07:00 [DBG] Server digi-tbhh2:29604:4144d765 heartbeat successfully sent
2025-07-08 16:39:15.006 +07:00 [DBG] Server digi-tbhh2:29604:4144d765 heartbeat successfully sent
2025-07-08 16:39:55.538 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 16:39:55.575 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-08 16:39:55.588 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-08 16:39:55.638 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-08 16:39:55.646 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 16:39:55.648 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-08 16:39:55.652 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-08 16:39:55.658 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-08 16:39:55.659 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-08 16:39:55.793 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-08 16:39:55.884 +07:00 [INF] Hangfire SQL objects installed.
2025-07-08 16:39:56.126 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-08 16:39:56.127 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-08 16:39:56.209 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-08 16:39:56.210 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-08 16:39:56.210 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-08 16:39:56.221 +07:00 [DBG] Execution loop BackgroundServerProcess:9f0fcd46 has started in 3.9979 ms
2025-07-08 16:39:56.227 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-08 16:39:56.228 +07:00 [INF] Hosting environment: Development
2025-07-08 16:39:56.229 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-08 16:39:56.237 +07:00 [INF] Server digi-tbhh2:2500:2fbec4f7 successfully announced in 9.902 ms
2025-07-08 16:39:56.243 +07:00 [DBG] Execution loop ServerHeartbeatProcess:d96e5606 has started in 3.784 ms
2025-07-08 16:39:56.243 +07:00 [INF] Server digi-tbhh2:2500:2fbec4f7 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-08 16:39:56.247 +07:00 [DBG] Execution loop ServerWatchdog:dc9bf603 has started in 2.8148 ms
2025-07-08 16:39:56.252 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:859d06bb has started in 7.2927 ms
2025-07-08 16:39:56.254 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:29c1f8f0 has started in 6.823 ms
2025-07-08 16:39:56.257 +07:00 [DBG] Execution loop ExpirationManager:de30b98f has started in 5.9591 ms
2025-07-08 16:39:56.260 +07:00 [DBG] Execution loop CountersAggregator:5997c091 has started in 5.5176 ms
2025-07-08 16:39:56.264 +07:00 [DBG] Execution loop Worker:1d931604 has started in 6.6308 ms
2025-07-08 16:39:56.266 +07:00 [DBG] Execution loop Worker:38320e41 has started in 8.5445 ms
2025-07-08 16:39:56.273 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-08 16:39:56.272 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-08 16:39:56.269 +07:00 [DBG] Execution loop Worker:57d61ba7 has started in 11.5558 ms
2025-07-08 16:39:56.272 +07:00 [DBG] Execution loop Worker:81e93658 has started in 14.5647 ms
2025-07-08 16:39:56.274 +07:00 [DBG] Execution loop Worker:f1355754 has started in 17.2101 ms
2025-07-08 16:39:56.277 +07:00 [DBG] Execution loop Worker:dcf8105c has started in 19.7356 ms
2025-07-08 16:39:56.295 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-08 16:39:56.279 +07:00 [DBG] Execution loop Worker:a0b4f834 has started in 22.5446 ms
2025-07-08 16:39:56.283 +07:00 [DBG] Execution loop Worker:d616a10f has started in 25.4601 ms
2025-07-08 16:39:56.286 +07:00 [DBG] Execution loop Worker:9b065b2e has started in 29.3954 ms
2025-07-08 16:39:56.289 +07:00 [DBG] Execution loop Worker:87d24aa6 has started in 32.1145 ms
2025-07-08 16:39:56.293 +07:00 [DBG] Execution loop Worker:48a7df63 has started in 36.3503 ms
2025-07-08 16:39:56.295 +07:00 [DBG] Execution loop Worker:338ee9b9 has started in 38.2035 ms
2025-07-08 16:39:56.322 +07:00 [INF] Server digi-tbhh2:2500:2fbec4f7 all the dispatchers started
2025-07-08 16:39:56.298 +07:00 [DBG] Execution loop Worker:308f6b63 has started in 40.6821 ms
2025-07-08 16:39:56.301 +07:00 [DBG] Execution loop Worker:23095991 has started in 44.1864 ms
2025-07-08 16:39:56.304 +07:00 [DBG] Execution loop Worker:8c5916b4 has started in 47.0853 ms
2025-07-08 16:39:56.308 +07:00 [DBG] Execution loop Worker:eea9624f has started in 51.4032 ms
2025-07-08 16:39:56.310 +07:00 [DBG] Execution loop Worker:cab42eb7 has started in 53.0972 ms
2025-07-08 16:39:56.326 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-08 16:39:56.313 +07:00 [DBG] Execution loop Worker:c42b9ffb has started in 55.8741 ms
2025-07-08 16:39:56.316 +07:00 [DBG] Execution loop Worker:8cb23e84 has started in 58.9747 ms
2025-07-08 16:39:56.319 +07:00 [DBG] Execution loop Worker:38b910c0 has started in 62.0259 ms
2025-07-08 16:39:56.333 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-08 16:39:56.322 +07:00 [DBG] Execution loop DelayedJobScheduler:0a3d0df8 has started in 5.8542 ms
2025-07-08 16:39:56.325 +07:00 [DBG] Execution loop RecurringJobScheduler:8b8b0c78 has started in 5.6394 ms
2025-07-08 16:39:56.336 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-08 16:39:56.521 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-08 16:39:56.521 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-08 16:39:56.546 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 32.6558ms
2025-07-08 16:39:56.602 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 88.4169ms
2025-07-08 16:39:56.643 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-08 16:39:56.673 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 29.9367ms
2025-07-08 16:40:26.270 +07:00 [DBG] Server digi-tbhh2:2500:2fbec4f7 heartbeat successfully sent
2025-07-08 16:40:38.383 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 571
2025-07-08 16:40:38.407 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:40:38.408 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:40:38.410 +07:00 [INF] Request from IP: ::1
2025-07-08 16:40:38.415 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:40:38.434 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:40:38.626 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-08 16:40:38.814 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 375.2321ms
2025-07-08 16:40:38.817 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:40:38.867 +07:00 [ERR] An unhandled exception has occurred.
System.ArgumentNullException: Value cannot be null. (Parameter 'configuration')
   at StackExchange.Redis.ConfigurationOptions.DoParse(String configuration, Boolean ignoreUnknown) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 870
   at StackExchange.Redis.ConfigurationOptions.Parse(String configuration, Boolean ignoreUnknown) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 676
   at StackExchange.Redis.ConfigurationOptions.Parse(String configuration) in /_/src/StackExchange.Redis/ConfigurationOptions.cs:line 666
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCacheOptions.GetConfiguredOptions()
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.ConnectSlowAsync(CancellationToken token)
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.RemoveAsync(String key, CancellationToken token)
   at pviBase.Services.InsuranceService.CreateInsuranceContracts(List`1 contractDtos) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 66
   at pviBase.Controllers.HubContractController.CreateContract(CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Controllers\HubContractController.cs:line 54
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 29
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 26
2025-07-08 16:40:38.939 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:40:38.945 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:40:38.950 +07:00 [ERR] Connection id "0HNDU0DIVANHC", Request id "0HNDU0DIVANHC:00000007": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-08 16:40:38.958 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 575.3063ms
2025-07-08 16:40:56.282 +07:00 [DBG] Server digi-tbhh2:2500:2fbec4f7 heartbeat successfully sent
2025-07-08 16:41:26.293 +07:00 [DBG] Server digi-tbhh2:2500:2fbec4f7 heartbeat successfully sent
2025-07-08 16:43:17.178 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 16:43:17.213 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-08 16:43:17.226 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-08 16:43:17.271 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-08 16:43:17.277 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 16:43:17.279 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-08 16:43:17.282 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-08 16:43:17.289 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-08 16:43:17.291 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-08 16:43:17.513 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-08 16:43:17.600 +07:00 [INF] Hangfire SQL objects installed.
2025-07-08 16:43:17.857 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-08 16:43:17.857 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-08 16:43:17.926 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-08 16:43:17.927 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-08 16:43:17.928 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-08 16:43:17.941 +07:00 [DBG] Execution loop BackgroundServerProcess:b0db9dbd has started in 5.029 ms
2025-07-08 16:43:17.945 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-08 16:43:17.946 +07:00 [INF] Hosting environment: Development
2025-07-08 16:43:17.947 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-08 16:43:17.955 +07:00 [INF] Server digi-tbhh2:27264:07445dc1 successfully announced in 9.2676 ms
2025-07-08 16:43:17.960 +07:00 [INF] Server digi-tbhh2:27264:07445dc1 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-08 16:43:17.960 +07:00 [DBG] Execution loop ServerHeartbeatProcess:a6fb52f8 has started in 3.9246 ms
2025-07-08 16:43:17.964 +07:00 [DBG] Execution loop ServerWatchdog:efc1a2af has started in 2.8591 ms
2025-07-08 16:43:17.970 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:9c501359 has started in 5.6193 ms
2025-07-08 16:43:17.967 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:6357b7d2 has started in 5.5466 ms
2025-07-08 16:43:17.973 +07:00 [DBG] Execution loop ExpirationManager:ff2ce553 has started in 5.3633 ms
2025-07-08 16:43:17.975 +07:00 [DBG] Execution loop CountersAggregator:5c0c5c41 has started in 5.2243 ms
2025-07-08 16:43:17.981 +07:00 [INF] 1 servers were removed due to timeout
2025-07-08 16:43:17.978 +07:00 [DBG] Execution loop Worker:49c24801 has started in 5.5285 ms
2025-07-08 16:43:17.987 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-08 16:43:17.987 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-08 16:43:17.981 +07:00 [DBG] Execution loop Worker:319c197b has started in 8.1844 ms
2025-07-08 16:43:17.984 +07:00 [DBG] Execution loop Worker:b3da0741 has started in 11.3947 ms
2025-07-08 16:43:17.986 +07:00 [DBG] Execution loop Worker:aadb7b2b has started in 14.0136 ms
2025-07-08 16:43:17.991 +07:00 [DBG] Execution loop Worker:bb2cb32f has started in 18.4053 ms
2025-07-08 16:43:17.992 +07:00 [DBG] Execution loop Worker:10ecce8c has started in 19.8604 ms
2025-07-08 16:43:18.012 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-08 16:43:17.995 +07:00 [DBG] Execution loop Worker:70bdcd2b has started in 22.4235 ms
2025-07-08 16:43:17.997 +07:00 [DBG] Execution loop Worker:db0bf136 has started in 25.0371 ms
2025-07-08 16:43:18.002 +07:00 [DBG] Execution loop Worker:ddec95c3 has started in 29.3833 ms
2025-07-08 16:43:18.038 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-08 16:43:18.043 +07:00 [INF] Server digi-tbhh2:27264:07445dc1 all the dispatchers started
2025-07-08 16:43:18.006 +07:00 [DBG] Execution loop Worker:811b9323 has started in 32.4706 ms
2025-07-08 16:43:18.008 +07:00 [DBG] Execution loop Worker:c60be2a5 has started in 35.9118 ms
2025-07-08 16:43:18.011 +07:00 [DBG] Execution loop Worker:ff18dbd2 has started in 38.9306 ms
2025-07-08 16:43:18.014 +07:00 [DBG] Execution loop Worker:a2bde770 has started in 41.8733 ms
2025-07-08 16:43:18.019 +07:00 [DBG] Execution loop Worker:4f07fb4b has started in 46.1965 ms
2025-07-08 16:43:18.022 +07:00 [DBG] Execution loop Worker:d273dfff has started in 49.6588 ms
2025-07-08 16:43:18.048 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-08 16:43:18.025 +07:00 [DBG] Execution loop Worker:e2464132 has started in 52.9063 ms
2025-07-08 16:43:18.028 +07:00 [DBG] Execution loop Worker:a58495b9 has started in 55.9768 ms
2025-07-08 16:43:18.033 +07:00 [DBG] Execution loop Worker:66aa6811 has started in 60.8291 ms
2025-07-08 16:43:18.056 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-08 16:43:18.037 +07:00 [DBG] Execution loop Worker:d3cd0225 has started in 65.0635 ms
2025-07-08 16:43:18.040 +07:00 [DBG] Execution loop Worker:26f08a20 has started in 67.1288 ms
2025-07-08 16:43:18.043 +07:00 [DBG] Execution loop DelayedJobScheduler:583369e0 has started in 5.4954 ms
2025-07-08 16:43:18.046 +07:00 [DBG] Execution loop RecurringJobScheduler:8c377cb6 has started in 5.9706 ms
2025-07-08 16:43:18.676 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-08 16:43:18.676 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-08 16:43:18.714 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 43.4884ms
2025-07-08 16:43:18.746 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 77.5639ms
2025-07-08 16:43:18.774 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-08 16:43:18.804 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 29.4586ms
2025-07-08 16:43:35.291 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 571
2025-07-08 16:43:35.312 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:43:35.313 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:43:35.315 +07:00 [INF] Request from IP: ::1
2025-07-08 16:43:35.319 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:43:35.337 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:43:35.504 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-08 16:43:47.997 +07:00 [DBG] Server digi-tbhh2:27264:07445dc1 heartbeat successfully sent
2025-07-08 16:43:49.038 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 13696.464ms
2025-07-08 16:43:49.039 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:43:49.138 +07:00 [ERR] An unhandled exception has occurred.
StackExchange.Redis.RedisConnectionException: The message timed out in the backlog attempting to send because no connection became available (5000ms) - Last Connection Exception: It was not possible to connect to the redis server(s). ConnectTimeout, command=DEL, timeout: 5000, inst: 0, qu: 0, qs: 0, aw: False, bw: CheckingForTimeout, rs: NotStarted, ws: Initializing, in: 0, last-in: 0, cur-in: 0, sync-ops: 0, async-ops: 1, serverEndpoint: localhost:6379, conn-sec: n/a, aoc: 0, mc: 1/1/0, mgr: 10 of 10 available, clientName: DIGI-TBHH2(SE.Redis-v2.7.27.49176), IOCP: (Busy=0,Free=1000,Min=1,Max=1000), WORKER: (Busy=0,Free=32767,Min=12,Max=32767), POOL: (Threads=7,QueuedItems=0,CompletedItems=253,Timers=7), v: 2.7.27.49176 (Please take a look at this article for some common client-side issues that can cause timeouts: https://stackexchange.github.io/StackExchange.Redis/Timeouts)
 ---> StackExchange.Redis.RedisConnectionException: It was not possible to connect to the redis server(s). ConnectTimeout
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.Caching.StackExchangeRedis.RedisCache.RemoveAsync(String key, CancellationToken token)
   at pviBase.Services.InsuranceService.CreateInsuranceContracts(List`1 contractDtos) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 66
   at pviBase.Controllers.HubContractController.CreateContract(CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Controllers\HubContractController.cs:line 54
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 29
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 26
2025-07-08 16:43:49.228 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:43:49.235 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:43:49.240 +07:00 [ERR] Connection id "0HNDU0FF71EGJ", Request id "0HNDU0FF71EGJ:00000007": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-08 16:43:49.246 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 13954.3243ms
2025-07-08 16:44:18.029 +07:00 [DBG] Server digi-tbhh2:27264:07445dc1 heartbeat successfully sent
2025-07-08 16:44:48.054 +07:00 [DBG] Server digi-tbhh2:27264:07445dc1 heartbeat successfully sent
2025-07-08 16:45:18.069 +07:00 [DBG] Server digi-tbhh2:27264:07445dc1 heartbeat successfully sent
2025-07-08 16:45:48.088 +07:00 [DBG] Server digi-tbhh2:27264:07445dc1 heartbeat successfully sent
2025-07-08 16:46:18.096 +07:00 [DBG] Server digi-tbhh2:27264:07445dc1 heartbeat successfully sent
2025-07-08 16:46:48.109 +07:00 [DBG] Server digi-tbhh2:27264:07445dc1 heartbeat successfully sent
2025-07-08 16:47:18.116 +07:00 [DBG] Server digi-tbhh2:27264:07445dc1 heartbeat successfully sent
2025-07-08 16:47:48.134 +07:00 [DBG] Server digi-tbhh2:27264:07445dc1 heartbeat successfully sent
2025-07-08 16:48:18.004 +07:00 [INF] 2 servers were removed due to timeout
2025-07-08 16:48:18.047 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-08 16:48:18.143 +07:00 [DBG] Server digi-tbhh2:27264:07445dc1 heartbeat successfully sent
2025-07-08 16:48:48.152 +07:00 [DBG] Server digi-tbhh2:27264:07445dc1 heartbeat successfully sent
2025-07-08 16:48:54.141 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 571
2025-07-08 16:48:54.154 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:48:54.154 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:48:54.155 +07:00 [INF] Request from IP: ::1
2025-07-08 16:48:54.156 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:48:54.157 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:48:54.162 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-08 16:48:54.206 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-08 16:48:54.309 +07:00 [INF] Executed DbCommand (28ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-08 16:48:54.337 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0'.
2025-07-08 16:48:54.345 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 186.1941ms
2025-07-08 16:48:54.346 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:48:54.472 +07:00 [ERR] An unhandled exception has occurred.
System.InvalidOperationException: Response Content-Length mismatch: too many bytes written (58 of 2).
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.VerifyAndUpdateWrite(Int32 count)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.FirstWriteAsyncInternal(ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.WritePipeAsync(ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseStream.WriteAsync(ReadOnlyMemory`1 source, CancellationToken cancellationToken)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 64
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 26
2025-07-08 16:48:54.541 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:48:54.544 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:48:54.546 +07:00 [ERR] Connection id "0HNDU0FF71EGK", Request id "0HNDU0FF71EGK:00000001": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-08 16:48:54.551 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 410.1381ms
2025-07-08 16:49:18.166 +07:00 [DBG] Server digi-tbhh2:27264:07445dc1 heartbeat successfully sent
2025-07-08 16:49:42.597 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 16:49:42.647 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-08 16:49:42.658 +07:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-08 16:49:42.701 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-08 16:49:42.707 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 16:49:42.709 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-08 16:49:42.712 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-08 16:49:42.718 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-08 16:49:42.719 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-08 16:49:42.931 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-08 16:49:43.044 +07:00 [INF] Hangfire SQL objects installed.
2025-07-08 16:49:43.341 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-08 16:49:43.342 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-08 16:49:43.410 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-08 16:49:43.411 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-08 16:49:43.412 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-08 16:49:43.423 +07:00 [DBG] Execution loop BackgroundServerProcess:fdcdfb99 has started in 4.2347 ms
2025-07-08 16:49:43.429 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-08 16:49:43.430 +07:00 [INF] Hosting environment: Development
2025-07-08 16:49:43.431 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-08 16:49:43.439 +07:00 [INF] Server digi-tbhh2:19892:efb824db successfully announced in 9.8091 ms
2025-07-08 16:49:43.466 +07:00 [DBG] Execution loop ServerHeartbeatProcess:e51fb194 has started in 24.9455 ms
2025-07-08 16:49:43.466 +07:00 [INF] Server digi-tbhh2:19892:efb824db is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-08 16:49:43.471 +07:00 [DBG] Execution loop ServerWatchdog:b48d9011 has started in 2.9314 ms
2025-07-08 16:49:43.474 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:3af403ae has started in 5.3237 ms
2025-07-08 16:49:43.476 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:70602bdb has started in 5.4261 ms
2025-07-08 16:49:43.479 +07:00 [DBG] Execution loop ExpirationManager:93bde286 has started in 4.9966 ms
2025-07-08 16:49:43.481 +07:00 [DBG] Execution loop CountersAggregator:72b4fdaa has started in 4.673 ms
2025-07-08 16:49:43.485 +07:00 [DBG] Execution loop Worker:c4d65338 has started in 6.592 ms
2025-07-08 16:49:43.488 +07:00 [DBG] Execution loop Worker:7d77c142 has started in 9.2093 ms
2025-07-08 16:49:43.498 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-08 16:49:43.498 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-08 16:49:43.511 +07:00 [DBG] Execution loop Worker:a0696d1e has started in 32.3903 ms
2025-07-08 16:49:43.490 +07:00 [DBG] Execution loop Worker:eff15c08 has started in 11.4905 ms
2025-07-08 16:49:43.492 +07:00 [DBG] Execution loop Worker:714892ee has started in 13.6377 ms
2025-07-08 16:49:43.528 +07:00 [DBG] Execution loop Worker:fe537285 has started in 49.6074 ms
2025-07-08 16:49:43.529 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-08 16:49:43.495 +07:00 [DBG] Execution loop Worker:583ff271 has started in 16.0391 ms
2025-07-08 16:49:43.497 +07:00 [DBG] Execution loop Worker:81c890ee has started in 18.8769 ms
2025-07-08 16:49:43.501 +07:00 [DBG] Execution loop Worker:a20bb164 has started in 21.6392 ms
2025-07-08 16:49:43.545 +07:00 [INF] Server digi-tbhh2:19892:efb824db all the dispatchers started
2025-07-08 16:49:43.503 +07:00 [DBG] Execution loop Worker:4133a492 has started in 24.3304 ms
2025-07-08 16:49:43.505 +07:00 [DBG] Execution loop Worker:c86ed4e7 has started in 26.8237 ms
2025-07-08 16:49:43.508 +07:00 [DBG] Execution loop Worker:dfbda8fc has started in 29.7937 ms
2025-07-08 16:49:43.515 +07:00 [DBG] Execution loop Worker:036ea0e9 has started in 35.5946 ms
2025-07-08 16:49:43.519 +07:00 [DBG] Execution loop Worker:32ded189 has started in 39.7423 ms
2025-07-08 16:49:43.522 +07:00 [DBG] Execution loop Worker:51afc7d6 has started in 43.6024 ms
2025-07-08 16:49:43.526 +07:00 [DBG] Execution loop Worker:b03386aa has started in 47.4251 ms
2025-07-08 16:49:43.552 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-08 16:49:43.531 +07:00 [DBG] Execution loop Worker:7c74c5c3 has started in 52.3719 ms
2025-07-08 16:49:43.535 +07:00 [DBG] Execution loop Worker:a5a6898e has started in 56.1308 ms
2025-07-08 16:49:43.537 +07:00 [DBG] Execution loop Worker:c9e07223 has started in 58.91 ms
2025-07-08 16:49:43.560 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-08 16:49:43.541 +07:00 [DBG] Execution loop Worker:02b8da38 has started in 62.476 ms
2025-07-08 16:49:43.546 +07:00 [DBG] Execution loop DelayedJobScheduler:37303802 has started in 7.6334 ms
2025-07-08 16:49:43.548 +07:00 [DBG] Execution loop RecurringJobScheduler:27ac9ca9 has started in 6.6939 ms
2025-07-08 16:49:43.562 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-08 16:49:44.292 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-08 16:49:44.292 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-08 16:49:44.323 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 38.2728ms
2025-07-08 16:49:44.359 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 75.4058ms
2025-07-08 16:49:44.389 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-08 16:49:44.420 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 31.1279ms
2025-07-08 16:50:12.702 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 570
2025-07-08 16:50:12.726 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:50:12.727 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:50:12.729 +07:00 [INF] Request from IP: ::1
2025-07-08 16:50:12.732 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:50:12.751 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:50:12.909 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-08 16:50:13.241 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-08 16:50:13.326 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-08 16:50:13.354 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0'.
2025-07-08 16:50:13.362 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 607.4098ms
2025-07-08 16:50:13.363 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:50:13.496 +07:00 [ERR] An unhandled exception has occurred.
System.InvalidOperationException: Response Content-Length mismatch: too many bytes written (58 of 2).
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.VerifyAndUpdateWrite(Int32 count)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.FirstWriteAsyncInternal(ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.WritePipeAsync(ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpResponseStream.WriteAsync(ReadOnlyMemory`1 source, CancellationToken cancellationToken)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 64
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 26
2025-07-08 16:50:13.499 +07:00 [DBG] Server digi-tbhh2:19892:efb824db heartbeat successfully sent
2025-07-08 16:50:13.600 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:50:13.609 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 16:50:13.614 +07:00 [ERR] Connection id "0HNDU0J23IHKA", Request id "0HNDU0J23IHKA:00000007": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-08 16:50:13.624 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 921.8789ms
2025-07-08 16:50:43.536 +07:00 [DBG] Server digi-tbhh2:19892:efb824db heartbeat successfully sent
2025-07-08 16:51:13.541 +07:00 [DBG] Server digi-tbhh2:19892:efb824db heartbeat successfully sent
2025-07-08 16:52:10.429 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 16:52:10.469 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-08 16:52:10.482 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-08 16:52:10.530 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-08 16:52:10.538 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 16:52:10.540 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-08 16:52:10.544 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-08 16:52:10.551 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-08 16:52:10.553 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-08 16:52:10.802 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-08 16:52:10.928 +07:00 [INF] Hangfire SQL objects installed.
2025-07-08 16:52:11.210 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-08 16:52:11.211 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-08 16:52:11.279 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-08 16:52:11.280 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-08 16:52:11.281 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-08 16:52:11.293 +07:00 [DBG] Execution loop BackgroundServerProcess:830a998c has started in 5.0007 ms
2025-07-08 16:52:11.299 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-08 16:52:11.300 +07:00 [INF] Hosting environment: Development
2025-07-08 16:52:11.301 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-08 16:52:11.308 +07:00 [INF] Server digi-tbhh2:10224:ed9023c6 successfully announced in 9.6242 ms
2025-07-08 16:52:11.313 +07:00 [DBG] Execution loop ServerHeartbeatProcess:68c6589b has started in 3.5205 ms
2025-07-08 16:52:11.313 +07:00 [INF] Server digi-tbhh2:10224:ed9023c6 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-08 16:52:11.318 +07:00 [DBG] Execution loop ServerWatchdog:c2db2d7d has started in 3.1692 ms
2025-07-08 16:52:11.322 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:7d2f2577 has started in 6.6348 ms
2025-07-08 16:52:11.324 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:3f1014af has started in 6.2656 ms
2025-07-08 16:52:11.327 +07:00 [DBG] Execution loop ExpirationManager:1b64fef6 has started in 5.3847 ms
2025-07-08 16:52:11.329 +07:00 [DBG] Execution loop CountersAggregator:1373f850 has started in 5.2367 ms
2025-07-08 16:52:11.334 +07:00 [DBG] Execution loop Worker:fed08437 has started in 7.7051 ms
2025-07-08 16:52:11.338 +07:00 [DBG] Execution loop Worker:6c89730d has started in 10.8031 ms
2025-07-08 16:52:11.344 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-08 16:52:11.343 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-08 16:52:11.339 +07:00 [DBG] Execution loop Worker:99fc045d has started in 12.611 ms
2025-07-08 16:52:11.362 +07:00 [DBG] Execution loop Worker:020e3722 has started in 34.8897 ms
2025-07-08 16:52:11.342 +07:00 [DBG] Execution loop Worker:0d70cc6e has started in 15.6936 ms
2025-07-08 16:52:11.345 +07:00 [DBG] Execution loop Worker:63082ddc has started in 18.6106 ms
2025-07-08 16:52:11.375 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-08 16:52:11.348 +07:00 [DBG] Execution loop Worker:e2b5b6c3 has started in 21.3106 ms
2025-07-08 16:52:11.352 +07:00 [DBG] Execution loop Worker:505a14cf has started in 25.2288 ms
2025-07-08 16:52:11.355 +07:00 [DBG] Execution loop Worker:4b7c2de4 has started in 28.1303 ms
2025-07-08 16:52:11.392 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-08 16:52:11.402 +07:00 [INF] Server digi-tbhh2:10224:ed9023c6 all the dispatchers started
2025-07-08 16:52:11.358 +07:00 [DBG] Execution loop Worker:469c4fe8 has started in 31.4359 ms
2025-07-08 16:52:11.366 +07:00 [DBG] Execution loop Worker:3ba74d49 has started in 38.7246 ms
2025-07-08 16:52:11.372 +07:00 [DBG] Execution loop Worker:46f9ddd4 has started in 44.8516 ms
2025-07-08 16:52:11.373 +07:00 [DBG] Execution loop Worker:4d83f5c4 has started in 46.7705 ms
2025-07-08 16:52:11.377 +07:00 [DBG] Execution loop Worker:e2bfee36 has started in 50.2112 ms
2025-07-08 16:52:11.380 +07:00 [DBG] Execution loop Worker:5c5b8aac has started in 53.3022 ms
2025-07-08 16:52:11.384 +07:00 [DBG] Execution loop Worker:5c5d2b6f has started in 57.2285 ms
2025-07-08 16:52:11.410 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-08 16:52:11.388 +07:00 [DBG] Execution loop Worker:04ba4048 has started in 60.8243 ms
2025-07-08 16:52:11.391 +07:00 [DBG] Execution loop Worker:42531b04 has started in 64.1147 ms
2025-07-08 16:52:11.395 +07:00 [DBG] Execution loop Worker:3cdc28a3 has started in 68.6653 ms
2025-07-08 16:52:11.398 +07:00 [DBG] Execution loop Worker:d3807c0c has started in 71.0108 ms
2025-07-08 16:52:11.402 +07:00 [DBG] Execution loop DelayedJobScheduler:e7a254ae has started in 7.6301 ms
2025-07-08 16:52:11.405 +07:00 [DBG] Execution loop RecurringJobScheduler:1380a2b7 has started in 6.9664 ms
2025-07-08 16:52:11.415 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-08 16:52:11.931 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-08 16:52:11.931 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-08 16:52:11.976 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 53.725ms
2025-07-08 16:52:12.013 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 92.6556ms
2025-07-08 16:52:12.043 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-08 16:52:12.072 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 29.5195ms
2025-07-08 16:52:24.672 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 570
2025-07-08 16:52:24.690 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:52:24.691 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:52:24.694 +07:00 [INF] Request from IP: ::1
2025-07-08 16:52:24.697 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:52:24.719 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:52:24.890 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-08 16:52:25.196 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-08 16:52:25.284 +07:00 [INF] Executed DbCommand (18ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-08 16:52:25.316 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0'.
2025-07-08 16:52:25.327 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 604.2452ms
2025-07-08 16:52:25.329 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 16:52:25.344 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 200 58 application/json 672.0123ms
2025-07-08 16:52:41.338 +07:00 [DBG] Server digi-tbhh2:10224:ed9023c6 heartbeat successfully sent
2025-07-08 16:53:11.347 +07:00 [DBG] Server digi-tbhh2:10224:ed9023c6 heartbeat successfully sent
2025-07-08 16:53:41.359 +07:00 [DBG] Server digi-tbhh2:10224:ed9023c6 heartbeat successfully sent
2025-07-08 16:54:11.377 +07:00 [DBG] Server digi-tbhh2:10224:ed9023c6 heartbeat successfully sent
2025-07-08 16:54:25.069 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - application/json-patch+json 115
2025-07-08 16:54:25.077 +07:00 [INF] CORS policy execution failed.
2025-07-08 16:54:25.078 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 16:54:25.079 +07:00 [INF] Request from IP: ::1
2025-07-08 16:54:25.080 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-08 16:54:25.085 +07:00 [INF] Route matched with {action = "GetContractByLoanNo", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetContractByLoanNo(pviBase.Dtos.GetContractByLoanNoRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 16:54:25.092 +07:00 [INF] Received request to get detailed contract for LoanNo: LN22000001
2025-07-08 16:54:25.337 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__loanNo_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [i].[Id], [i].[CreatedAt], [i].[CustAddress], [i].[CustBirthday], [i].[CustEmail], [i].[CustGender], [i].[CustIdNo], [i].[CustName], [i].[CustPhone], [i].[DisbursementDate], [i].[InsRate], [i].[LoanAmount], [i].[LoanDate], [i].[LoanNo], [i].[LoanTerm], [i].[LoanType], [i].[UpdatedAt]
FROM [InsuranceContracts] AS [i]
WHERE [i].[LoanNo] = @__loanNo_0
2025-07-08 16:54:25.355 +07:00 [INF] Successfully retrieved detailed contract for LoanNo: LN22000001
2025-07-08 16:54:25.356 +07:00 [INF] Executing OkObjectResult, writing value of type 'pviBase.Dtos.GetContractByLoanNoResponseDataDto'.
2025-07-08 16:54:25.363 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase) in 277.5847ms
2025-07-08 16:54:25.365 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.GetContractByLoanNo (pviBase)'
2025-07-08 16:54:25.371 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_GetContract_ByLoanNo - 200 1018 application/json 302.6983ms
2025-07-08 16:54:41.382 +07:00 [DBG] Server digi-tbhh2:10224:ed9023c6 heartbeat successfully sent
2025-07-08 16:55:11.399 +07:00 [DBG] Server digi-tbhh2:10224:ed9023c6 heartbeat successfully sent
2025-07-08 16:55:41.416 +07:00 [DBG] Server digi-tbhh2:10224:ed9023c6 heartbeat successfully sent
2025-07-08 17:07:49.303 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 17:07:49.360 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-08 17:07:49.371 +07:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-08 17:07:49.416 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-08 17:07:49.423 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-08 17:07:49.425 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-08 17:07:49.429 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-08 17:07:49.435 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-08 17:07:49.437 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-08 17:07:49.685 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-08 17:07:49.770 +07:00 [INF] Hangfire SQL objects installed.
2025-07-08 17:07:50.189 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-08 17:07:50.190 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-08 17:07:50.263 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-08 17:07:50.264 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-08 17:07:50.264 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-08 17:07:50.277 +07:00 [DBG] Execution loop BackgroundServerProcess:0eb8296e has started in 5.6693 ms
2025-07-08 17:07:50.283 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-08 17:07:50.284 +07:00 [INF] Hosting environment: Development
2025-07-08 17:07:50.285 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-08 17:07:50.291 +07:00 [INF] Server digi-tbhh2:7820:f6a0d0e7 successfully announced in 7.5921 ms
2025-07-08 17:07:50.296 +07:00 [DBG] Execution loop ServerHeartbeatProcess:00710e4d has started in 3.7462 ms
2025-07-08 17:07:50.296 +07:00 [INF] Server digi-tbhh2:7820:f6a0d0e7 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-08 17:07:50.300 +07:00 [DBG] Execution loop ServerWatchdog:9abf54d6 has started in 2.7652 ms
2025-07-08 17:07:50.307 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:85bcc60f has started in 9.4105 ms
2025-07-08 17:07:50.310 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:fc900757 has started in 9.8439 ms
2025-07-08 17:07:50.313 +07:00 [DBG] Execution loop ExpirationManager:89195f8b has started in 5.4515 ms
2025-07-08 17:07:50.319 +07:00 [INF] 3 servers were removed due to timeout
2025-07-08 17:07:50.316 +07:00 [DBG] Execution loop CountersAggregator:0cd0c0cf has started in 5.7913 ms
2025-07-08 17:07:50.329 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-08 17:07:50.320 +07:00 [DBG] Execution loop Worker:4f0e77a0 has started in 6.4002 ms
2025-07-08 17:07:50.334 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-08 17:07:50.323 +07:00 [DBG] Execution loop Worker:b2670c4b has started in 9.6265 ms
2025-07-08 17:07:50.325 +07:00 [DBG] Execution loop Worker:9da61673 has started in 12.379 ms
2025-07-08 17:07:50.328 +07:00 [DBG] Execution loop Worker:7a3a75d3 has started in 15.021 ms
2025-07-08 17:07:50.331 +07:00 [DBG] Execution loop Worker:7a1353d4 has started in 17.9277 ms
2025-07-08 17:07:50.391 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-08 17:07:50.333 +07:00 [DBG] Execution loop Worker:d2b1c8c0 has started in 20.5276 ms
2025-07-08 17:07:50.337 +07:00 [DBG] Execution loop Worker:a9463285 has started in 23.1505 ms
2025-07-08 17:07:50.340 +07:00 [DBG] Execution loop Worker:6e81c36b has started in 26.6044 ms
2025-07-08 17:07:50.421 +07:00 [INF] Server digi-tbhh2:7820:f6a0d0e7 all the dispatchers started
2025-07-08 17:07:50.342 +07:00 [DBG] Execution loop Worker:e5acfc39 has started in 29.3607 ms
2025-07-08 17:07:50.345 +07:00 [DBG] Execution loop Worker:8b03c92f has started in 32.3362 ms
2025-07-08 17:07:50.351 +07:00 [DBG] Execution loop Worker:8d0cdb61 has started in 37.6482 ms
2025-07-08 17:07:50.354 +07:00 [DBG] Execution loop Worker:02a9f814 has started in 40.8944 ms
2025-07-08 17:07:50.387 +07:00 [DBG] Execution loop Worker:c1fd51ae has started in 74.1476 ms
2025-07-08 17:07:50.387 +07:00 [DBG] Execution loop Worker:30ef7856 has started in 74.1496 ms
2025-07-08 17:07:50.398 +07:00 [DBG] Execution loop Worker:6755b6cd has started in 82.5279 ms
2025-07-08 17:07:50.428 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-08 17:07:50.401 +07:00 [DBG] Execution loop Worker:d89b481a has started in 88.0701 ms
2025-07-08 17:07:50.405 +07:00 [DBG] Execution loop Worker:a439971d has started in 91.9148 ms
2025-07-08 17:07:50.439 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-08 17:07:50.409 +07:00 [DBG] Execution loop Worker:9f6cf959 has started in 95.5962 ms
2025-07-08 17:07:50.413 +07:00 [DBG] Execution loop Worker:f4118f0a has started in 99.5719 ms
2025-07-08 17:07:50.418 +07:00 [DBG] Execution loop Worker:3cc37d4e has started in 104.5162 ms
2025-07-08 17:07:50.421 +07:00 [DBG] Execution loop DelayedJobScheduler:e01aae03 has started in 8.4514 ms
2025-07-08 17:07:50.424 +07:00 [DBG] Execution loop RecurringJobScheduler:243c7c85 has started in 6.5894 ms
2025-07-08 17:07:50.442 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-08 17:07:50.940 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-08 17:07:50.940 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-08 17:07:50.969 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 27.733ms
2025-07-08 17:07:51.012 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 78.1735ms
2025-07-08 17:07:51.041 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-08 17:07:51.078 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 37.2949ms
2025-07-08 17:08:04.617 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 570
2025-07-08 17:08:04.651 +07:00 [INF] CORS policy execution failed.
2025-07-08 17:08:04.652 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 17:08:04.655 +07:00 [INF] Request from IP: ::1
2025-07-08 17:08:04.658 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 17:08:04.680 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 17:08:04.864 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-08 17:08:05.158 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-08 17:08:05.237 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-08 17:08:05.273 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0'.
2025-07-08 17:08:05.283 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 598.8235ms
2025-07-08 17:08:05.284 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 17:08:05.300 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 200 58 application/json 682.0599ms
2025-07-08 17:08:10.537 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 569
2025-07-08 17:08:10.542 +07:00 [INF] CORS policy execution failed.
2025-07-08 17:08:10.542 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 17:08:10.543 +07:00 [INF] Request from IP: ::1
2025-07-08 17:08:10.544 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 17:08:10.546 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 17:08:10.561 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-07-08 17:08:10.578 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 30.1437ms
2025-07-08 17:08:10.580 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 17:08:10.582 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 400 285 application/problem+json; charset=utf-8 44.9133ms
2025-07-08 17:08:20.317 +07:00 [DBG] Server digi-tbhh2:7820:f6a0d0e7 heartbeat successfully sent
2025-07-08 17:08:26.248 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 534
2025-07-08 17:08:26.252 +07:00 [INF] CORS policy execution failed.
2025-07-08 17:08:26.253 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 17:08:26.254 +07:00 [INF] Request from IP: ::1
2025-07-08 17:08:26.254 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 17:08:26.255 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 17:08:26.261 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-08 17:08:26.303 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-08 17:08:26.320 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-08 17:08:26.374 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'pviBase.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'CustEmail', table 'InsuranceHubDb.dbo.InsuranceContracts'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:980ed44c-458b-4910-ab9d-27e40d1f6c86
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'CustEmail', table 'InsuranceHubDb.dbo.InsuranceContracts'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:980ed44c-458b-4910-ab9d-27e40d1f6c86
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-07-08 17:08:26.459 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 203.0211ms
2025-07-08 17:08:26.461 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 17:08:26.581 +07:00 [ERR] An unhandled exception has occurred.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'CustEmail', table 'InsuranceHubDb.dbo.InsuranceContracts'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:980ed44c-458b-4910-ab9d-27e40d1f6c86
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at pviBase.Services.InsuranceService.CreateInsuranceContracts(List`1 contractDtos) in C:\Users\ADMIN\source\repos\pviBase\Services\InsuranceService.cs:line 70
   at pviBase.Controllers.HubContractController.CreateContract(CreateContractRequestDto request) in C:\Users\ADMIN\source\repos\pviBase\Controllers\HubContractController.cs:line 54
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 29
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 26
2025-07-08 17:08:26.696 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 17:08:26.703 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-08 17:08:26.706 +07:00 [ERR] Connection id "0HNDU0T5USN7V", Request id "0HNDU0T5USN7V:0000000B": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 58
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 31
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-08 17:08:26.723 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 474.8759ms
2025-07-08 17:08:50.321 +07:00 [DBG] Server digi-tbhh2:7820:f6a0d0e7 heartbeat successfully sent
2025-07-08 17:09:20.332 +07:00 [DBG] Server digi-tbhh2:7820:f6a0d0e7 heartbeat successfully sent
2025-07-08 17:09:21.903 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 570
2025-07-08 17:09:21.906 +07:00 [INF] CORS policy execution failed.
2025-07-08 17:09:21.907 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-08 17:09:21.908 +07:00 [INF] Request from IP: ::1
2025-07-08 17:09:21.909 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 17:09:21.910 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-08 17:09:21.912 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-08 17:09:21.918 +07:00 [INF] Removed cache key: InsuranceContract:LN22000001
2025-07-08 17:09:21.929 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-08 17:09:21.932 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0'.
2025-07-08 17:09:21.933 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 21.7678ms
2025-07-08 17:09:21.934 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-08 17:09:21.935 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 200 58 application/json 32.3321ms
2025-07-08 17:09:50.346 +07:00 [DBG] Server digi-tbhh2:7820:f6a0d0e7 heartbeat successfully sent
2025-07-08 17:10:20.359 +07:00 [DBG] Server digi-tbhh2:7820:f6a0d0e7 heartbeat successfully sent
