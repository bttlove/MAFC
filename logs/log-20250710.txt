2025-07-10 08:57:48.876 +07:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-10 08:57:48.914 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-10 08:57:48.929 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-10 08:57:48.971 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-10 08:57:48.979 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-10 08:57:48.981 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-10 08:57:48.985 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-10 08:57:48.991 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-10 08:57:48.995 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-10 08:57:49.267 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-10 08:57:49.395 +07:00 [INF] Hangfire SQL objects installed.
2025-07-10 08:57:49.890 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-10 08:57:49.891 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-10 08:57:50.054 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-10 08:57:50.055 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-10 08:57:50.056 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-10 08:57:50.065 +07:00 [DBG] Execution loop BackgroundServerProcess:655d457e has started in 5.0224 ms
2025-07-10 08:57:50.072 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-10 08:57:50.072 +07:00 [INF] Hosting environment: Development
2025-07-10 08:57:50.073 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-10 08:57:50.079 +07:00 [INF] Server digi-tbhh2:2812:90d58b79 successfully announced in 7.8916 ms
2025-07-10 08:57:50.084 +07:00 [DBG] Execution loop ServerHeartbeatProcess:521f08ec has started in 3.3936 ms
2025-07-10 08:57:50.084 +07:00 [INF] Server digi-tbhh2:2812:90d58b79 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-10 08:57:50.087 +07:00 [DBG] Execution loop ServerWatchdog:b515068b has started in 2.8824 ms
2025-07-10 08:57:50.090 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:2dfc8a62 has started in 5.3741 ms
2025-07-10 08:57:50.093 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:38db2e61 has started in 5.0463 ms
2025-07-10 08:57:50.095 +07:00 [DBG] Execution loop ExpirationManager:d6ad93c3 has started in 4.8223 ms
2025-07-10 08:57:50.097 +07:00 [DBG] Execution loop CountersAggregator:86d5fabd has started in 4.6502 ms
2025-07-10 08:57:50.106 +07:00 [DBG] Execution loop Worker:cb833370 has started in 10.5175 ms
2025-07-10 08:57:50.103 +07:00 [INF] 1 servers were removed due to timeout
2025-07-10 08:57:50.112 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-10 08:57:50.119 +07:00 [DBG] Execution loop Worker:9bb40594 has started in 23.5608 ms
2025-07-10 08:57:50.109 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-10 08:57:50.101 +07:00 [DBG] Execution loop Worker:162bbd01 has started in 5.3666 ms
2025-07-10 08:57:50.103 +07:00 [DBG] Execution loop Worker:c144a4b6 has started in 8.0984 ms
2025-07-10 08:57:50.108 +07:00 [DBG] Execution loop Worker:5ea47a51 has started in 13.1006 ms
2025-07-10 08:57:50.111 +07:00 [DBG] Execution loop Worker:1afd3040 has started in 15.6582 ms
2025-07-10 08:57:50.113 +07:00 [DBG] Execution loop Worker:13b623a9 has started in 18.1707 ms
2025-07-10 08:57:50.116 +07:00 [DBG] Execution loop Worker:18faac4d has started in 20.8841 ms
2025-07-10 08:57:50.177 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-10 08:57:50.185 +07:00 [INF] Server digi-tbhh2:2812:90d58b79 all the dispatchers started
2025-07-10 08:57:50.121 +07:00 [DBG] Execution loop Worker:57012f8e has started in 26.0269 ms
2025-07-10 08:57:50.124 +07:00 [DBG] Execution loop Worker:f469ad6e has started in 29.0594 ms
2025-07-10 08:57:50.127 +07:00 [DBG] Execution loop Worker:d0dd628f has started in 31.7413 ms
2025-07-10 08:57:50.130 +07:00 [DBG] Execution loop Worker:d980bc68 has started in 34.8804 ms
2025-07-10 08:57:50.133 +07:00 [DBG] Execution loop Worker:464ae24a has started in 37.8197 ms
2025-07-10 08:57:50.162 +07:00 [DBG] Execution loop Worker:659ccbf2 has started in 66.6676 ms
2025-07-10 08:57:50.195 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-10 08:57:50.162 +07:00 [DBG] Execution loop Worker:6d11e424 has started in 66.7096 ms
2025-07-10 08:57:50.166 +07:00 [DBG] Execution loop Worker:ad3b1b21 has started in 71.2325 ms
2025-07-10 08:57:50.170 +07:00 [DBG] Execution loop Worker:e2b38f5a has started in 75.1966 ms
2025-07-10 08:57:50.176 +07:00 [DBG] Execution loop Worker:f6a7b264 has started in 81.2929 ms
2025-07-10 08:57:50.201 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-10 08:57:50.179 +07:00 [DBG] Execution loop Worker:a2a9f64d has started in 84.1871 ms
2025-07-10 08:57:50.183 +07:00 [DBG] Execution loop Worker:fd152930 has started in 87.4003 ms
2025-07-10 08:57:50.186 +07:00 [DBG] Execution loop DelayedJobScheduler:1780dc36 has started in 6.1743 ms
2025-07-10 08:57:50.189 +07:00 [DBG] Execution loop RecurringJobScheduler:9773d81a has started in 6.0719 ms
2025-07-10 08:57:50.204 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-10 08:57:50.302 +07:00 [DBG] 1 recurring job(s) processed by scheduler.
2025-07-10 08:57:50.381 +07:00 [INF] Performing daily data cleanup at 7/10/2025 8:57:50 AM
2025-07-10 08:57:50.707 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger - null null
2025-07-10 08:57:50.834 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger - 301 0 null 132.4142ms
2025-07-10 08:57:50.844 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/index.html - null null
2025-07-10 08:57:50.886 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/index.html - 200 null text/html;charset=utf-8 41.6199ms
2025-07-10 08:57:50.906 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/swagger-ui.css - null null
2025-07-10 08:57:50.907 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/index.css - null null
2025-07-10 08:57:50.907 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/swagger-ui-bundle.js - null null
2025-07-10 08:57:50.912 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/swagger-ui-standalone-preset.js - null null
2025-07-10 08:57:50.912 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-10 08:57:50.912 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/index.js - null null
2025-07-10 08:57:50.918 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-10 08:57:50.931 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/index.js - 200 null application/javascript;charset=utf-8 18.7889ms
2025-07-10 08:57:50.952 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 39.4434ms
2025-07-10 08:57:50.954 +07:00 [INF] Sending file. Request path: '/index.css'. Physical path: 'N/A'
2025-07-10 08:57:50.962 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/index.css - 200 202 text/css 55.405ms
2025-07-10 08:57:50.976 +07:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2025-07-10 08:57:50.976 +07:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2025-07-10 08:57:50.984 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/swagger-ui.css - 200 154949 text/css 77.5369ms
2025-07-10 08:57:50.984 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/swagger-ui-standalone-preset.js - 200 229223 text/javascript 72.083ms
2025-07-10 08:57:50.993 +07:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2025-07-10 08:57:50.995 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/swagger-ui-bundle.js - 200 1485241 text/javascript 88.7627ms
2025-07-10 08:57:51.010 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 91.6248ms
2025-07-10 08:57:51.283 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-10 08:57:51.298 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/favicon-32x32.png - null null
2025-07-10 08:57:51.299 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 16.9544ms
2025-07-10 08:57:51.301 +07:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2025-07-10 08:57:51.305 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/favicon-32x32.png - 200 628 image/png 7.6687ms
2025-07-10 08:57:51.402 +07:00 [INF] Daily data cleanup completed.
2025-07-10 08:58:20.114 +07:00 [DBG] Server digi-tbhh2:2812:90d58b79 heartbeat successfully sent
2025-07-10 08:58:50.131 +07:00 [DBG] Server digi-tbhh2:2812:90d58b79 heartbeat successfully sent
2025-07-10 08:58:58.087 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 568
2025-07-10 08:58:58.113 +07:00 [INF] CORS policy execution failed.
2025-07-10 08:58:58.114 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-10 08:58:58.117 +07:00 [INF] Request from IP: ::1
2025-07-10 08:58:58.120 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-10 08:58:58.138 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-10 08:58:58.313 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 170.7532ms
2025-07-10 08:58:58.316 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-10 08:58:58.378 +07:00 [ERR] An unhandled exception has occurred.
FluentValidation.AsyncValidatorInvokedSynchronouslyException: Validator "CreateContractRequestDtoValidator" can't be used with ASP.NET automatic validation as it contains asynchronous rules. ASP.NET's validation pipeline is not asynchronous and can't invoke asynchronous rules. Remove the asynchronous rules in order for this validator to run.
   at FluentValidation.AbstractValidator`1.Validate(ValidationContext`1 context) in /_/src/FluentValidation/AbstractValidator.cs:line 207
   at FluentValidation.AbstractValidator`1.FluentValidation.IValidator.Validate(IValidationContext context) in /_/src/FluentValidation/AbstractValidator.cs:line 153
   at FluentValidation.AspNetCore.FluentValidationModelValidator.Validate(ModelValidationContext mvContext) in /_/src/FluentValidation.AspNetCore/FluentValidationModelValidatorProvider.cs:line 150
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.ValidateNode()
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.VisitComplexType(IValidationStrategy defaultStrategy)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.VisitImplementation(ModelMetadata& metadata, String& key, Object model)
   at Microsoft.AspNetCore.Mvc.ModelBinding.Validation.ValidationVisitor.Visit(ModelMetadata metadata, String key, Object model)
   at FluentValidation.AspNetCore.FluentValidationVisitor.<>n__1(ModelMetadata metadata, String key, Object model, Boolean alwaysValidateAtTopLevel, Object container)
   at FluentValidation.AspNetCore.FluentValidationVisitor.<>c__DisplayClass2_0.<Validate>g__BaseValidate|0() in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 45
   at FluentValidation.AspNetCore.FluentValidationVisitor.ValidateInternal(ModelMetadata metadata, String key, Object model, Func`1 continuation) in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 63
   at FluentValidation.AspNetCore.FluentValidationVisitor.Validate(ModelMetadata metadata, String key, Object model, Boolean alwaysValidateAtTopLevel, Object container) in /_/src/FluentValidation.AspNetCore/FluentValidationVisitor.cs:line 47
   at Microsoft.AspNetCore.Mvc.ModelBinding.ObjectModelValidator.Validate(ActionContext actionContext, ValidationStateDictionary validationState, String prefix, Object model, ModelMetadata metadata, Object container)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.EnforceBindRequiredAndValidate(ObjectModelValidator baseObjectValidator, ActionContext actionContext, ParameterDescriptor parameter, ModelMetadata metadata, ModelBindingContext modelBindingContext, ModelBindingResult modelBindingResult, Object container)
   at Microsoft.AspNetCore.Mvc.ModelBinding.ParameterBinder.BindModelAsync(ActionContext actionContext, IModelBinder modelBinder, IValueProvider valueProvider, ParameterDescriptor parameter, ModelMetadata metadata, Object value, Object container)
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerBinderDelegateProvider.<>c__DisplayClass0_0.<<CreateBinderDelegate>g__Bind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at pviBase.Middlewares.ResponseWrappingMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ResponseWrappingMiddleware.cs:line 29
   at pviBase.Middlewares.IpWhitelistMiddleware.InvokeAsync(HttpContext context) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\IpWhitelistMiddleware.cs:line 38
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 28
2025-07-10 08:58:58.460 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 60
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 33
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-10 08:58:58.466 +07:00 [ERR] An exception was thrown attempting to display the error page.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.DisplayExceptionContent(ErrorContext errorContext)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-07-10 08:58:58.469 +07:00 [ERR] Connection id "0HNDVAKMDIDQ1", Request id "0HNDVAKMDIDQ1:00000017": An unhandled exception was thrown by the application.
System.ObjectDisposedException: Cannot access a closed Stream.
   at System.IO.MemoryStream.Write(Byte[] buffer, Int32 offset, Int32 count)
   at System.IO.MemoryStream.WriteAsync(ReadOnlyMemory`1 buffer, CancellationToken cancellationToken)
--- End of stack trace from previous location ---
   at System.IO.Pipelines.StreamPipeWriter.FlushAsyncInternal(Boolean writeToStream, ReadOnlyMemory`1 data, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at System.Threading.Tasks.ValueTask`1.GetTaskForValueTaskSource(IValueTaskSource`1 t)
--- End of stack trace from previous location ---
   at pviBase.Middlewares.ExceptionHandlingMiddleware.HandleExceptionAsync(HttpContext context, Exception exception) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 60
   at pviBase.Middlewares.ExceptionHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\ADMIN\source\repos\pviBase\Middlewares\ExceptionHandlingMiddleware.cs:line 33
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
   at Microsoft.WebTools.BrowserLink.Net.BrowserLinkMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Watch.BrowserRefresh.BrowserRefreshMiddleware.InvokeAsync(HttpContext context)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
2025-07-10 08:58:58.487 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 500 0 null 399.686ms
2025-07-10 08:59:20.150 +07:00 [DBG] Server digi-tbhh2:2812:90d58b79 heartbeat successfully sent
2025-07-10 08:59:50.169 +07:00 [DBG] Server digi-tbhh2:2812:90d58b79 heartbeat successfully sent
2025-07-10 09:20:02.648 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-10 09:20:02.680 +07:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-07-10 09:20:02.695 +07:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-07-10 09:20:02.739 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-07-10 09:20:02.747 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-07-10 09:20:02.749 +07:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-07-10 09:20:02.752 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-07-10 09:20:02.758 +07:00 [INF] No migrations were applied. The database is already up to date.
2025-07-10 09:20:02.761 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-07-10 09:20:02.987 +07:00 [INF] Start installing Hangfire SQL objects...
2025-07-10 09:20:03.090 +07:00 [INF] Hangfire SQL objects installed.
2025-07-10 09:20:03.356 +07:00 [INF] Now listening on: https://localhost:7024
2025-07-10 09:20:03.357 +07:00 [INF] Now listening on: http://localhost:5017
2025-07-10 09:20:03.426 +07:00 [INF] Starting Hangfire Server using job storage: 'SQL Server: (localdb)\mssqllocaldb@InsuranceHubDb'
2025-07-10 09:20:03.427 +07:00 [INF] Using the following options for SQL Server job storage: Queue poll interval: 00:00:00.
2025-07-10 09:20:03.428 +07:00 [INF] Using the following options for Hangfire Server:
    Worker count: 20
    Listening queues: 'default'
    Shutdown timeout: 00:00:15
    Schedule polling interval: 00:00:15
2025-07-10 09:20:03.437 +07:00 [DBG] Execution loop BackgroundServerProcess:dcf356b6 has started in 4.5889 ms
2025-07-10 09:20:03.443 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2025-07-10 09:20:03.445 +07:00 [INF] Hosting environment: Development
2025-07-10 09:20:03.446 +07:00 [INF] Content root path: C:\Users\ADMIN\source\repos\pviBase
2025-07-10 09:20:03.453 +07:00 [INF] Server digi-tbhh2:27152:34e868b5 successfully announced in 9.7942 ms
2025-07-10 09:20:03.457 +07:00 [INF] Server digi-tbhh2:27152:34e868b5 is starting the registered dispatchers: ServerWatchdog, ServerJobCancellationWatcher, SqlServerHeartbeatProcess, ExpirationManager, CountersAggregator, Worker, DelayedJobScheduler, RecurringJobScheduler...
2025-07-10 09:20:03.459 +07:00 [DBG] Execution loop ServerHeartbeatProcess:a4a23830 has started in 4.0211 ms
2025-07-10 09:20:03.462 +07:00 [DBG] Execution loop ServerWatchdog:b1441851 has started in 3.1622 ms
2025-07-10 09:20:03.465 +07:00 [DBG] Execution loop ServerJobCancellationWatcher:f22309ab has started in 5.1065 ms
2025-07-10 09:20:03.468 +07:00 [DBG] Execution loop SqlServerHeartbeatProcess:47f998ba has started in 4.8511 ms
2025-07-10 09:20:03.470 +07:00 [DBG] Execution loop ExpirationManager:23bd7bf2 has started in 5.1255 ms
2025-07-10 09:20:03.474 +07:00 [DBG] Execution loop CountersAggregator:61c8ca89 has started in 6.7721 ms
2025-07-10 09:20:03.476 +07:00 [DBG] Execution loop Worker:4d20b70b has started in 6.1652 ms
2025-07-10 09:20:03.493 +07:00 [INF] 1 servers were removed due to timeout
2025-07-10 09:20:03.497 +07:00 [DBG] Removing outdated records from the 'AggregatedCounter' table...
2025-07-10 09:20:03.494 +07:00 [DBG] Aggregating records in 'Counter' table...
2025-07-10 09:20:03.479 +07:00 [DBG] Execution loop Worker:f430e72f has started in 9.6284 ms
2025-07-10 09:20:03.485 +07:00 [DBG] Execution loop Worker:6135cf57 has started in 14.6439 ms
2025-07-10 09:20:03.488 +07:00 [DBG] Execution loop Worker:690a54ad has started in 18.0699 ms
2025-07-10 09:20:03.491 +07:00 [DBG] Execution loop Worker:39bd4116 has started in 21.4018 ms
2025-07-10 09:20:03.526 +07:00 [DBG] Removing outdated records from the 'Job' table...
2025-07-10 09:20:03.493 +07:00 [DBG] Execution loop Worker:7ec35b30 has started in 23.5018 ms
2025-07-10 09:20:03.496 +07:00 [DBG] Execution loop Worker:23c55e2f has started in 26.6339 ms
2025-07-10 09:20:03.500 +07:00 [DBG] Execution loop Worker:51fa58c8 has started in 30.1442 ms
2025-07-10 09:20:03.503 +07:00 [DBG] Execution loop Worker:4dabc1a6 has started in 32.8379 ms
2025-07-10 09:20:03.554 +07:00 [INF] Server digi-tbhh2:27152:34e868b5 all the dispatchers started
2025-07-10 09:20:03.554 +07:00 [DBG] Removing outdated records from the 'List' table...
2025-07-10 09:20:03.506 +07:00 [DBG] Execution loop Worker:5efec3f2 has started in 36.158 ms
2025-07-10 09:20:03.510 +07:00 [DBG] Execution loop Worker:837c4c9b has started in 39.8334 ms
2025-07-10 09:20:03.564 +07:00 [DBG] Removing outdated records from the 'Set' table...
2025-07-10 09:20:03.514 +07:00 [DBG] Execution loop Worker:e35532aa has started in 43.8969 ms
2025-07-10 09:20:03.518 +07:00 [DBG] Execution loop Worker:16713478 has started in 47.7509 ms
2025-07-10 09:20:03.521 +07:00 [DBG] Execution loop Worker:5d2ccdcf has started in 51.3045 ms
2025-07-10 09:20:03.525 +07:00 [DBG] Execution loop Worker:5f37b114 has started in 55.2692 ms
2025-07-10 09:20:03.529 +07:00 [DBG] Execution loop Worker:391edc22 has started in 59.0145 ms
2025-07-10 09:20:03.534 +07:00 [DBG] Execution loop Worker:fb869bef has started in 64.6856 ms
2025-07-10 09:20:03.541 +07:00 [DBG] Execution loop Worker:c4e7f83c has started in 70.1769 ms
2025-07-10 09:20:03.546 +07:00 [DBG] Execution loop Worker:a0b1908a has started in 76.6946 ms
2025-07-10 09:20:03.550 +07:00 [DBG] Execution loop Worker:5bfdebfc has started in 80.751 ms
2025-07-10 09:20:03.554 +07:00 [DBG] Execution loop DelayedJobScheduler:2b351b64 has started in 7.3 ms
2025-07-10 09:20:03.557 +07:00 [DBG] Execution loop RecurringJobScheduler:c8cbdb46 has started in 6.6273 ms
2025-07-10 09:20:03.571 +07:00 [DBG] Removing outdated records from the 'Hash' table...
2025-07-10 09:20:03.858 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - null null
2025-07-10 09:20:03.858 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/_vs/browserLink - null null
2025-07-10 09:20:03.884 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_framework/aspnetcore-browser-refresh.js - 200 16499 application/javascript; charset=utf-8 33.0853ms
2025-07-10 09:20:03.920 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/_vs/browserLink - 200 null text/javascript; charset=UTF-8 69.963ms
2025-07-10 09:20:03.947 +07:00 [INF] Request starting HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - null null
2025-07-10 09:20:03.979 +07:00 [INF] Request finished HTTP/2 GET https://localhost:7024/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 31.9851ms
2025-07-10 09:20:18.032 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 568
2025-07-10 09:20:18.052 +07:00 [INF] CORS policy execution failed.
2025-07-10 09:20:18.053 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-10 09:20:18.055 +07:00 [INF] Request from IP: ::1
2025-07-10 09:20:18.058 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-10 09:20:18.077 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-10 09:20:18.430 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__loanNo_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [InsuranceContracts] AS [i]
        WHERE [i].[LoanNo] = @__loanNo_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-07-10 09:20:18.451 +07:00 [INF] Received request to create contracts. Product Code: MAFC_SKNVV, Data Count: 1
2025-07-10 09:20:18.456 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__loanNo_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [InsuranceContracts] AS [i]
        WHERE [i].[LoanNo] = @__loanNo_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-07-10 09:20:18.563 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 1000), @p2='?' (DbType = DateTime2), @p3='?' (Size = 4000), @p4='?' (Size = 50), @p5='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [RequestLogs] ([CreatedAt], [ErrorMessage], [LastUpdatedAt], [RequestData], [RequestId], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-07-10 09:20:18.639 +07:00 [INF] Enqueued job for RequestId: 134c1135-5fd1-47a8-a472-dfebb55f2025
2025-07-10 09:20:18.652 +07:00 [INF] Executing AcceptedResult, writing value of type 'pviBase.Dtos.ApiResponse`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-07-10 09:20:18.665 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 583.7142ms
2025-07-10 09:20:18.666 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-10 09:20:18.677 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 202 99 application/json 644.1931ms
2025-07-10 09:20:18.797 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__requestId_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [r].[Id], [r].[CreatedAt], [r].[ErrorMessage], [r].[LastUpdatedAt], [r].[RequestData], [r].[RequestId], [r].[Status]
FROM [RequestLogs] AS [r]
WHERE [r].[RequestId] = @__requestId_0
2025-07-10 09:20:18.810 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0, [Status] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-10 09:20:18.814 +07:00 [INF] Processing job for RequestId: 134c1135-5fd1-47a8-a472-dfebb55f2025
2025-07-10 09:20:18.816 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__loanNo_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [InsuranceContracts] AS [i]
        WHERE [i].[LoanNo] = @__loanNo_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-07-10 09:20:19.062 +07:00 [INF] Removed cache key: InsuranceContract:05052003
2025-07-10 09:20:19.074 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (DbType = DateTime2), @p1='?' (Size = 200), @p2='?' (DbType = DateTime2), @p3='?' (Size = 200), @p4='?' (Size = 1), @p5='?' (Size = 12), @p6='?' (Size = 200), @p7='?' (Size = 10), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Double), @p10='?' (DbType = Int64), @p11='?' (DbType = DateTime2), @p12='?' (Size = 50), @p13='?' (DbType = Int32), @p14='?' (Size = 50), @p15='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [InsuranceContracts] ([CreatedAt], [CustAddress], [CustBirthday], [CustEmail], [CustGender], [CustIdNo], [CustName], [CustPhone], [DisbursementDate], [InsRate], [LoanAmount], [LoanDate], [LoanNo], [LoanTerm], [LoanType], [UpdatedAt])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15);
2025-07-10 09:20:19.078 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = DateTime2), @p1='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [RequestLogs] SET [LastUpdatedAt] = @p0, [Status] = @p1
OUTPUT 1
WHERE [Id] = @p2;
2025-07-10 09:20:19.080 +07:00 [INF] Job for RequestId: 134c1135-5fd1-47a8-a472-dfebb55f2025 completed successfully.
2025-07-10 09:20:26.881 +07:00 [INF] Request starting HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - application/json-patch+json 568
2025-07-10 09:20:26.886 +07:00 [INF] CORS policy execution failed.
2025-07-10 09:20:26.887 +07:00 [INF] Request origin https://localhost:7024 does not have permission to access the resource.
2025-07-10 09:20:26.888 +07:00 [INF] Request from IP: ::1
2025-07-10 09:20:26.889 +07:00 [INF] Executing endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-10 09:20:26.890 +07:00 [INF] Route matched with {action = "CreateContract", controller = "HubContract"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateContract(pviBase.Dtos.CreateContractRequestDto) on controller pviBase.Controllers.HubContractController (pviBase).
2025-07-10 09:20:26.897 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__loanNo_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [InsuranceContracts] AS [i]
        WHERE [i].[LoanNo] = @__loanNo_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-07-10 09:20:26.905 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'pviBase.Dtos.ApiResponse'.
2025-07-10 09:20:26.910 +07:00 [INF] Executed action pviBase.Controllers.HubContractController.CreateContract (pviBase) in 18.7486ms
2025-07-10 09:20:26.911 +07:00 [INF] Executed endpoint 'pviBase.Controllers.HubContractController.CreateContract (pviBase)'
2025-07-10 09:20:26.912 +07:00 [INF] Request finished HTTP/2 POST https://localhost:7024/api/v1/HubContract/MAFC_SKNVV_CreateContract - 400 195 application/json; charset=utf-8 31.4767ms
2025-07-10 09:20:33.493 +07:00 [DBG] Server digi-tbhh2:27152:34e868b5 heartbeat successfully sent
